[
    {
        "change_date": 1764069002669.0,
        "changed_by": {
            "id": "af10323b-7030-4dbe-af1b-cbf71f532c06",
            "name": "l.lutz",
            "type_": "USER"
        },
        "created_by": {
            "id": "2202cbc9-7251-4630-bfb2-36812e688613",
            "name": "l.pigozzi",
            "type_": "USER"
        },
        "creation_date": 1749633725549.0,
        "data_connection_id": "b9f449da-3a15-43d8-89e3-0e87e54fb5af",
        "description": null,
        "disabled": null,
        "display_name": "PayableItem - SAP ECC",
        "draft": null,
        "factory_id": "dba7c1a0-28d2-4cfb-b1ab-b69df91da25a",
        "factory_validation_status": "VALID",
        "has_user_template": true,
        "local_parameters": [
            {
                "name": "sourceSystem",
                "value": "'SAP_ECC'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "PayableItem",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [
                    {
                        "id": "Changes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\n\t<%=sourceSystem%> || '::'|| \"CDPOS\".\"TABKEY\" || '::' || \"CDPOS\".\"TABNAME\" \n        || '::' || \"CDPOS\".\"FNAME\" || '::' || \"CDPOS\".\"CHANGENR\" \n        || '::' || \"CDPOS\".\"CHNGIND\"                                            AS \"ID\",\n    <%=sourceSystem%> || '::' || \n        SUBSTRING(\"CDPOS\".\"TABKEY\", 1, 3)  || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 4, 4)  || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 8, 10) || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 18, 4) || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 22, 3)                                      AS \"ObjectID\", \n    CAST(\"CDHDR\".\"UDATE\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, \n        CAST(\"CDHDR\".\"UTIME\" AS DATE), \"CDHDR\".\"UTIME\") AS INTERVAL SECOND)     AS \"Time\",\n\tCASE\n           WHEN \"CDPOS\".\"FNAME\" = 'SGTXT' THEN 'ItemText'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZFBDT' THEN 'BaseLineDate'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD1T' THEN 'PaymentDays1'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD2T' THEN 'PaymentDays2'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD3T' THEN 'PaymentDays3'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD1P' THEN 'DiscountPercentage1'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD2P' THEN 'DiscountPercentage2'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSCH' THEN 'PaymentMethod'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZTERM' THEN 'PaymentTerms'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_NEW\", '') IS NULL  THEN 'ReleasePaymentBlock'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_OLD\", '') IS NULL  THEN 'SetPaymentBlock'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_OLD\", '') IS NOT NULL \n                AND NULLIF(\"CDPOS\".\"VALUE_NEW\", '') IS NOT NULL  THEN 'PaymentBlock'\n     END                                                                        AS \"Attribute\",\n\tCASE\n        WHEN \"CDPOS\".\"VALUE_OLD\" LIKE '%-' \n            THEN CONCAT('-',REPLACE(LTRIM(\"CDPOS\".\"VALUE_OLD\"), '-', ''))\n        ELSE \"CDPOS\".\"VALUE_OLD\" \n     END                                                                        AS \"OldValue\",\n\tCASE\n        WHEN \"CDPOS\".\"VALUE_NEW\" LIKE '%-' \n            THEN CONCAT('-', REPLACE(LTRIM(\"CDPOS\".\"VALUE_NEW\"), '-', ''))\n        ELSE \"CDPOS\".\"VALUE_NEW\"\n     END                                                                        AS \"NewValue\",\n\t<%=sourceSystem%>  || '::' || \"CDHDR\".\"MANDANT\" \n        || '::' || \"CDHDR\".\"USERNAME\"                                           AS \"ChangedBy\",\n\t\"CDHDR\".\"TCODE\"                                                             AS \"OperationType\",\n\t<%=sourceSystem%>  || '::' || \"CDHDR\".\"CHANGENR\"                            AS \"OperationID\",\n\tCASE\n        WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic'\n        ELSE 'Manual' \n     END                                                                        AS \"ExecutionType\"\nFROM \"CDPOS\" AS \"CDPOS\"\n         LEFT JOIN \"CDHDR\" AS \"CDHDR\"\n                   ON \"CDPOS\".\"MANDANT\" = \"CDHDR\".\"MANDANT\"\n                       AND \"CDPOS\".\"OBJECTCLAS\" = \"CDHDR\".\"OBJECTCLAS\"\n                       AND \"CDPOS\".\"ObjectID\" = \"CDHDR\".\"ObjectID\"\n                       AND \"CDPOS\".\"CHANGENR\" = \"CDHDR\".\"CHANGENR\"\n                       AND \"CDPOS\".\"OBJECTCLAS\" = 'BELEG'\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"CDHDR\".\"USERNAME\" = \"USR02\".\"BNAME\"\n                       AND \"CDHDR\".\"MANDANT\" = \"USR02\".\"MANDT\"\nWHERE \"CDPOS\".\"TABNAME\" IN ('BSEG')\n  AND \"CDPOS\".\"FNAME\" IN ('SGTXT', 'ZFBDT', 'ZTERM', 'ZLSCH', 'ZLSPR', 'ZBD1T', 'ZBD2T', 'ZBD3T', 'ZBD1P', 'ZBD2P')\n  AND \"CDPOS\".\"CHNGIND\" = 'U'\n  AND NULLIF(\"CDPOS\".\"MANDANT\", '') IS NOT NULL\n  AND NULLIF(\"CDHDR\".\"MANDANT\", '') IS NOT NULL\n"
                    },
                    {
                        "id": "Clearing",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\n    'Clearing' || \n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"BUKRS\" \n            ||  '::'  ||\"BKPF\".\"BELNR\"|| '::' ||  \"BKPF\".\"GJAHR\" \n        ELSE <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" || '::' ||  \"BSEG\".\"BUKRS\" \n            ||'::' ||  \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n     END \n      -- concatenating with object ID to make it unique\n     || '::' || \n    <%=sourceSystem%>  || '::'|| \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\" || '::' || \"BSEG\".\"BUZEI\"                           AS \"ID\",\n    <%=sourceSystem%>  || '::'|| \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\" || '::' || \"BSEG\".\"BUZEI\"                           AS \"ObjectID\",\n    CASE\n\t    WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN CAST(\"BKPF\".\"CPUDT\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND) \n        ELSE CAST(\"BSEG\".\"AUGDT\" AS DATE) + INTERVAL '86399' SECOND\n     END                                                                                                        AS \"Time\",\n    'Clearing'                                                                                                  AS \"Attribute\",\n    NULL                                                                                                        AS \"OldValue\", \n    NULL                                                                                                        AS \"NewValue\",\n    CASE\n\t    WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"USNAM\"\n        ELSE NULL \n     END                                                                                                        AS \"ChangedBy\",\n    NULL                                                                                                        AS \"OperationType\",\n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"BUKRS\" \n            || '::' || \"BKPF\".\"BELNR\"|| '::' || \"BKPF\".\"GJAHR\" \n        WHEN \"BSEG\".\"AUGGJ\" <> '0000'\n            THEN <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" ||'::' ||  \"BSEG\".\"BUKRS\" \n            || '::' || \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n        ELSE <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" ||'::' ||  \"BSEG\".\"BUKRS\" \n            || '::' || \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n            || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\"|| '::' || \"BSEG\".\"BUZEI\"  -- workaround to avoid duplicates\n     END                                                                                                        AS  \"OperationID\",\n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL AND \"USR02\".\"USTYP\" IN ('B', 'C')\n\t        THEN 'Automatic'\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL AND \"USR02\".\"USTYP\" NOT IN ('B', 'C')\n            THEN 'Manual' \n        ELSE NULL\n     END                                                                                                        AS \"ExecutionType\"\nFROM \"BSEG\" AS \"BSEG\"\n         LEFT JOIN \"BKPF\" AS \"BKPF\"\n                   ON \"BSEG\".\"MANDT\" = \"BKPF\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n                       AND \"BSEG\".\"AUGBL\" = \"BKPF\".\"BELNR\"\n                       AND \"BSEG\".\"AUGGJ\" = \"BKPF\".\"GJAHR\"\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n                       AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\nWHERE \"BSEG\".\"KOART\" = 'K'\n    AND NULLIF(\"BSEG\".\"AUGBL\", '') IS NOT NULL\n    AND \"BSEG\".\"BSCHL\" IN ('21','31')\n"
                    },
                    {
                        "id": "Payment",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT DISTINCT \n    'Payment' || \n    <%=sourceSystem%> || '::'|| \"BSEG_PAYMENT\".\"MANDT\" || '::' || \"BSEG_PAYMENT\".\"BUKRS\" \n        || '::' || \"BSEG_PAYMENT\".\"BELNR\" || '::' || \"BSEG_PAYMENT\".\"GJAHR\" \n        || '::' || \"BSEG_PAYMENT\".\"BUZEI\"  \n        -- concatenating with object ID to make it unique\n        || '::'  \n        || <%=sourceSystem%> || '::' || \"BSEG_PAYABLE_ITEM\".\"MANDT\" \n        || '::' ||  \"BSEG_PAYABLE_ITEM\".\"BUKRS\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BELNR\" || '::' || \"BSEG_PAYABLE_ITEM\".\"GJAHR\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BUZEI\"                                              AS \"ID\",\n    <%=sourceSystem%> || '::' || \"BSEG_PAYABLE_ITEM\".\"MANDT\" || '::' || \"BSEG_PAYABLE_ITEM\".\"BUKRS\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BELNR\" || '::' || \"BSEG_PAYABLE_ITEM\".\"GJAHR\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BUZEI\"                                              AS \"ObjectID\",\n    CAST(\n        CAST(\"BKPF\".\"CPUDT\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND) AS TIMESTAMP)                       AS \"Time\",\n    'Payment'                                                                               AS \"Attribute\",\n\tNULL                                                                                    AS \"OldValue\",\n\tNULL                                                                                    AS \"NewValue\", \n    <%=sourceSystem%> || '::' || \"BKPF\".\"MANDT\"  || '::' || \"BKPF\".\"USNAM\"                  AS \"ChangedBy\",\n    NULL                                                                                    AS \"OperationType\",\n    <%=sourceSystem%> || '::' || \"BSEG_PAYMENT\".\"MANDT\" || '::' || \"BSEG_PAYMENT\".\"BUKRS\" \n        || '::' || \"BSEG_PAYMENT\".\"BELNR\" || '::' || \"BSEG_PAYMENT\".\"GJAHR\" \n        || '::' || \"BSEG_PAYMENT\".\"BUZEI\"                                                   AS \"OperationID\", \n    CASE \n        WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic'\n        ELSE 'Manual' \n     END                                                                                    AS \"ExecutionType\"\nFROM \"BKPF\" AS \"BKPF\"\n    INNER JOIN \"BSEG\" AS \"BSEG_PAYMENT\" \n        ON \"BKPF\".\"MANDT\" = \"BSEG_PAYMENT\".\"MANDT\"\n            AND \"BKPF\".\"BUKRS\" = \"BSEG_PAYMENT\".\"BUKRS\"\n            AND \"BKPF\".\"BELNR\" = \"BSEG_PAYMENT\".\"BELNR\"\n            AND \"BKPF\".\"GJAHR\" = \"BSEG_PAYMENT\".\"GJAHR\"\n    LEFT JOIN \"BSEG\" AS \"BSEG_PAYABLE_ITEM\"\n        ON  \"BSEG_PAYABLE_ITEM\".\"MANDT\" = \"BKPF\".\"MANDT\"\n            AND \"BSEG_PAYABLE_ITEM\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n            AND \"BSEG_PAYABLE_ITEM\".\"AUGBL\" = \"BKPF\".\"BELNR\"\n            AND \"BSEG_PAYABLE_ITEM\".\"AUGGJ\" = \"BKPF\".\"GJAHR\"\n    LEFT JOIN \"USR02\" AS \"USR02\"\n        ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n            AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\nWHERE NULLIF(\"BSEG_PAYMENT\".\"MANDT\", '') IS NOT NULL\n    AND \"BSEG_PAYMENT\".\"BSCHL\" IN ('25','26')\n    AND \"BSEG_PAYABLE_ITEM\".\"BSCHL\" IN ('31')"
                    }
                ],
                "foreign_key_names": [
                    "CreatedBy",
                    "Vendor",
                    "VendorInvoice"
                ],
                "namespace": "custom",
                "property_names": [
                    "Amount",
                    "BaselineDate",
                    "BusinessUnit",
                    "CashDiscountDueDate1",
                    "CashDiscountDueDate2",
                    "CashDiscountEligibleAmount1",
                    "CashDiscountEligibleAmount2",
                    "CashDiscountTakenAmount",
                    "ClearingDate",
                    "CreationExecutionType",
                    "CreationTime",
                    "Currency",
                    "DebitCreditIndicator",
                    "DocumentCategory",
                    "DocumentDate",
                    "FiscalYear",
                    "ID",
                    "IsBlockedForPayment",
                    "IsPurchaseDocumentRelated",
                    "IsReversed",
                    "ItemNumber",
                    "NetDueDate",
                    "PaymentMethodCode",
                    "PaymentTerms",
                    "ReceiptDate",
                    "Reference",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "PayableItemAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\t\n    <%=sourceSystem%> || '::' || \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' ||\"BSEG\".\"BELNR\" || '::' ||\"BSEG\".\"GJAHR\" \n        || '::' || \"BSEG\".\"BUZEI\"                                               AS \"ID\",\n    <%=sourceSystem%> || '::' || \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"USNAM\"       AS \"CreatedBy\",\n    <%=sourceSystem%> || '::' || \"RBKP\".\"MANDT\" || '::' ||\"RBKP\".\"BELNR\" \n        || '::' ||\"RBKP\".\"GJAHR\"                                                AS \"VendorInvoice\",\n    <%=sourceSystem%> || '::' || \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"LIFNR\"       AS \"Vendor\",\n\tCAST(\"BKPF\".\"GJAHR\" AS BIGINT)                                              AS \"FiscalYear\",\n\tCAST(\"BSEG\".\"BUZEI\" AS VARCHAR(255))                                        AS \"ItemNumber\",\n    CAST(\"BKPF\".\"CPUDT\" AS DATE) \n        + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND)                         AS \"CreationTime\",\n\tCAST(\"BKPF\".\"REINDAT\" AS TIMESTAMP)                                         AS \"ReceiptDate\",\n\tCASE\n        WHEN \"BKPF\".\"AWTYP\" = 'RMRP' THEN TRUE\n           ELSE FALSE \n     END                                                                        AS \"IsPurchaseDocumentRelated\",\n\tCASE\n        WHEN NULLIF(\"BKPF\".\"XREVERSAL\", '') IS NOT NULL \n            THEN TRUE\n        WHEN \"BSEG\".\"BSCHL\" IN ('21','31') AND \"BKPF\".\"TCODE\" = 'MR8M'\n            THEN TRUE\n        WHEN NULLIF(\"RBKP\".\"STBLG\", '') IS NOT NULL \n            THEN TRUE \n        ELSE FALSE\n     END                                                                        AS \"IsReversed\",\n\tCASE WHEN NULLIF(\"BSEG\".\"ZLSPR\", '') IS NOT NULL THEN TRUE ELSE FALSE END   AS \"IsBlockedForPayment\",\n\tCASE\n       WHEN \"BSEG\".\"SHKZG\" = 'H' THEN 'Credit' \n       WHEN \"BSEG\".\"SHKZG\" = 'S' THEN 'Debit' \n       ELSE 'Other'\n     END                                                                        AS \"DebitCreditIndicator\",\n\tCASE\n       WHEN \"BSEG\".\"BSCHL\" = '21' AND \"BKPF\".\"TCODE\" = 'MR8M'\n           THEN 'CreditMemoItem - ReversalDocument' \n       WHEN \"BSEG\".\"BSCHL\" = '21' \n         THEN 'CreditMemoItem'\n       WHEN \"BSEG\".\"BSCHL\" = '31' AND \"BKPF\".\"TCODE\" = 'MR8M'\n           THEN 'InvoiceItem - ReversalDocument' \n       WHEN \"BSEG\".\"BSCHL\" = '31' \n           THEN 'InvoiceItem' \n       ELSE 'Other'\n     END                                                                        AS \"DocumentCategory\",\n\t\"BKPF\".\"XBLNR\"                                                              AS \"Reference\",\n\tCAST(\"BKPF\".\"BLDAT\" AS TIMESTAMP)                                           AS \"DocumentDate\",\n\tCAST(\"BSEG\".\"ZFBDT\" AS TIMESTAMP)                                           AS \"BaselineDate\",\n\tCASE\n       WHEN \"BSEG\".\"ZBD3T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD3T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       WHEN \"BSEG\".\"ZBD3T\" = 0 AND \"BSEG\".\"ZBD2T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD2T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       WHEN \"BSEG\".\"ZBD3T\" = 0 AND \"BSEG\".\"ZBD2T\" = 0\n            AND \"BSEG\".\"ZBD1T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD1T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       ELSE CAST(\"BSEG\".\"ZFBDT\" AS TIMESTAMP) + INTERVAL '86399' SECOND\n       END                                                                      AS \"NetDueDate\",\n\tCASE\n       WHEN  \"BSEG\".\"ZBD2P\" > 0 AND \"BSEG\".\"ZBD2T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD2T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       END                                                                      AS \"CashDiscountDueDate2\",\n\tCASE\n       WHEN  \"BSEG\".\"ZBD1P\" > 0 AND \"BSEG\".\"ZBD1T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD1T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       END                                                                      AS \"CashDiscountDueDate1\",\n\t\"BSEG\".\"ZLSCH\"                                                              AS \"PaymentMethodCode\",\n\tCAST(\"BSEG\".\"AUGDT\" AS TIMESTAMP)                                           AS \"ClearingDate\",\n    \"BSEG\".\"ZTERM\"                                                              AS \"PaymentTerms\",\n\t\"BSEG\".\"WRBTR\" *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"Amount\",\n    \"BSEG\".\"WSKTO\"   *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountTakenAmount\",\n\t\"BSEG\".\"SKFBT\" * \"BSEG\".\"ZBD2P\" / 100  *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountEligibleAmount2\",\n\t\"BSEG\".\"SKFBT\" * \"BSEG\".\"ZBD1P\" / 100 *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountEligibleAmount1\",\n\t\"BKPF\".\"WAERS\"                                                              AS \"Currency\",\n    \"BSEG\".\"BUKRS\" || ' - ' || \"T001\".\"BUTXT\"                                   AS \"BusinessUnit\",\n    CASE WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic' ELSE 'Manual' END  AS \"CreationExecutionType\",\n\t<%=sourceSystem%>  || '::' || \"BSEG\".\"MANDT\"                                AS \"SourceSystemInstance\"\nFROM \"BSEG\" AS \"BSEG\"\n         LEFT JOIN \"BKPF\" AS \"BKPF\"\n                   ON \"BSEG\".\"MANDT\" = \"BKPF\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n                       AND \"BSEG\".\"BELNR\" = \"BKPF\".\"BELNR\"\n                       AND \"BSEG\".\"GJAHR\" = \"BKPF\".\"GJAHR\"\n         LEFT JOIN \"RBKP\" AS \"RBKP\"\n                   ON \"BKPF\".\"MANDT\" = \"RBKP\".\"MANDT\"\n                       AND \"BKPF\".\"BUKRS\" = \"RBKP\".\"BUKRS\"\n                       AND \"BKPF\".\"AWKEY\" = \"RBKP\".\"BELNR\" || \"RBKP\".\"GJAHR\"\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n                       AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\n         LEFT JOIN \"T001\" AS \"T001\"\n                   ON \"BSEG\".\"MANDT\" = \"T001\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"T001\".\"BUKRS\"\nWHERE NULLIF(\"BSEG\".\"MANDT\", '') IS NOT NULL\n    AND \"BSEG\".\"BSCHL\" IN ('21','31')  "
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1761757648978.0,
        "changed_by": {
            "id": "8b0fa45b-28fe-4314-bf39-c9e18042a5f4",
            "name": "Johannes Muhr",
            "type_": "USER"
        },
        "created_by": {
            "id": "2202cbc9-7251-4630-bfb2-36812e688613",
            "name": "l.pigozzi",
            "type_": "USER"
        },
        "creation_date": 1749630806997.0,
        "data_connection_id": "42d53587-d7fa-45cf-8403-26770d8029d0",
        "description": "",
        "disabled": null,
        "display_name": "PayableItem transformation - 00. Central Extraction Pool_Oracle-ebs - 1",
        "draft": null,
        "factory_id": "cf08e422-17c0-4f98-80cf-30537c1ce752",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "languageKey",
                "value": "'US'"
            },
            {
                "name": "sourceSystem",
                "value": "'Oracle_EBS'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "PayableItem",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [
                    {
                        "id": "Changes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT \n    <%=sourceSystem%> || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"DATE\"                                                   AS \"ID\",\n    <%=sourceSystem%> || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"                                                              AS \"ObjectID\",            \n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"DATE\"                                                                  AS \"Time\",\n    CASE\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'PAYMENT_METHOD_CODE' \n            THEN 'PaymentMethod'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'DUE_DATE' \n            THEN 'DueDate'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'DISCOUNT_DATE' \n            THEN 'DiscountDate1'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'SECOND_DISCOUNT_DATE' \n            THEN 'DiscountDate2'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'DISCOUNT_AMOUNT_AVAILABLE' \n            THEN 'DiscountAmount1'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'SECOND_DISC_AMT_AVAILABLE' \n            THEN 'DiscountAmount2'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'INV_CURR_GROSS_AMOUNT' \n            THEN 'InvoiceGrossAmount'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'HOLD_FLAG' \n            AND AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG.\"NEW_VALUE\" = 'N' \n            THEN 'ReleasePaymentBlock' \n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'HOLD_FLAG' \n            AND AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG.\"NEW_VALUE\" = 'Y'  \n            THEN 'SetPaymentBlock' \n    END                                                                                                                  AS \"Attribute\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"OLD_VALUE\"                                                             AS \"OldValue\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"NEW_VALUE\"                                                             AS \"NewValue\",\n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"USER\"                                      AS \"ChangedBy\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"TYPE\"                                                                  AS \"OperationType\",\n    NULL                                                                                                                 AS \"OperationID\", \n    NULL                                                                                                                 AS \"ExecutionType\"\nFROM \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\" AS \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\"\n    LEFT JOIN \"AP_PAYMENT_SCHEDULES_ALL\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"ID\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"\nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" IS NOT NULL\n    AND \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" IN ('PAYMENT_METHOD_CODE', 'HOLD_FLAG',\n            'DUE_DATE','DISCOUNT_DATE', 'SECOND_DISCOUNT_DATE','DISCOUNT_AMOUNT_AVAILABLE', 'SECOND_DISC_AMT_AVAILABLE','INV_CURR_GROSS_AMOUNT')\n    AND \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"TYPE\" = 'update'"
                    },
                    {
                        "id": "Clearing",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_AGG_INV_PMT\" AS (\n    SELECT \n        \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_ID\"              AS \"INVOICE_ID\",\n        \"AP_INVOICE_PAYMENTS_ALL\".\"PAYMENT_NUM\"             AS \"PAYMENT_NUM\" ,\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"CREATION_DATE\")      AS \"PAYMENT_DATE\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"CHECK_ID\")           AS \"PAYMENT_ID\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_PAYMENT_ID\") AS \"INVOICE_PAYMENT_ID\"\n    FROM \"AP_INVOICE_PAYMENTS_ALL\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    WHERE (NULLIF(\"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_FLAG\", '') IS NULL\n            OR \"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_FLAG\" = 'N')\n    GROUP BY \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_ID\",\"AP_INVOICE_PAYMENTS_ALL\".\"PAYMENT_NUM\" \n)\nSELECT \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n       || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" \n       || '::' || 'CLEARING' || '::' || \"AGG_INV_PMT\".\"INVOICE_PAYMENT_ID\"                                             AS \"ID\",      \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n       || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"                                                             AS \"ObjectID\",      \n    \"AP_CHECKS_ALL\".\"CREATION_DATE\"                                                                                    AS \"Time\",\n    'Clearing'                                                                                                         AS \"Attribute\",\n    NULL                                                                                                               AS \"OldValue\",\n    CAST(\"AP_CHECKS_ALL\".\"CREATION_DATE\"  AS VARCHAR(255))                                                             AS \"NewValue\",\n    <%=sourceSystem%> || '::' || CAST(\"AP_CHECKS_ALL\".\"Created_By\"  AS VARCHAR(255))                                   AS \"ChangedBy\",\n    NULL                                                                                                               AS \"OperationType\",\n    <%=sourceSystem%> || '::' || CAST(\"AP_CHECKS_ALL\".\"CHECK_ID\" AS VARCHAR(255))                                      AS \"OperationID\",\n    CASE\n        WHEN \"AP_CHECKS_ALL\".\"PAYMENT_TYPE_FLAG\" = 'A'\n            THEN 'Automatic'\n        ELSE 'Manual'\n    END                                                                                                                AS \"ExecutionType\"\nFROM \"CTE_AGG_INV_PMT\" AS \"AGG_INV_PMT\"\n    LEFT JOIN \"AP_PAYMENT_SCHEDULES_ALL\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AGG_INV_PMT\".\"INVOICE_ID\" || \"AGG_INV_PMT\".\"PAYMENT_NUM\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" \n    LEFT JOIN \"AP_CHECKS_ALL\" AS \"AP_CHECKS_ALL\"\n        ON \"AGG_INV_PMT\".\"PAYMENT_ID\" = \"AP_CHECKS_ALL\".\"CHECK_ID\"      \n    LEFT JOIN \"AP_INVOICES_ALL\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" = \"AP_INVOICES_ALL\".\"INVOICE_ID\"           \nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" IS NOT NULL\n    AND \"AP_CHECKS_ALL\".\"VOID_DATE\" IS NULL\n    AND \"AP_INVOICES_ALL\".\"PAYMENT_STATUS_FLAG\" = 'Y'\n    AND \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" IN ('STANDARD','CREDIT','DEBIT')"
                    },
                    {
                        "id": "Payment",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" \n        || '::' || 'PAYMENT' || '::' || \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_PAYMENT_ID\"                                     AS \"ID\",        \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"                                                                AS \"ObjectID\",    \n    \"AP_CHECKS_ALL\".\"CREATION_DATE\"                                                                                        AS \"Time\",\n    CASE \n        WHEN \"AP_CHECKS_ALL\".\"VOID_DATE\" IS NOT NULL AND \"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_INV_PMT_ID\"  IS NOT NULL\n            THEN 'ReversalPayment'\n        WHEN \"AP_CHECKS_ALL\".\"VOID_DATE\" IS NOT NULL AND \"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_INV_PMT_ID\" IS NULL \n            THEN 'ReversedPayment'\n        WHEN \"AP_CHECKS_ALL\".\"VOID_DATE\" IS NULL \n            THEN 'Payment'\n        ELSE 'Other' \n    END                                                                                                                    AS \"Attribute\",                                                                                               \n    NULL                                                                                                                   AS \"OldValue\",\n    NULL                                                                                                                   AS \"NewValue\",\n    <%=sourceSystem%> || '::'|| CAST(\"AP_CHECKS_ALL\".\"Created_By\" AS VARCHAR(255))                                         AS \"ChangedBy\",\n    NULL                                                                                                                   AS \"OperationType\",\n    <%=sourceSystem%> || '::'|| CAST(\"AP_CHECKS_ALL\".\"CHECK_ID\" AS VARCHAR(255))                                           AS \"OperationID\",\n    CASE\n        WHEN \"AP_CHECKS_ALL\".\"PAYMENT_TYPE_FLAG\" = 'A'\n            THEN 'Automatic'\n        ELSE 'Manual'\n    END                                                                                                                    AS \"ExecutionType\"\nFROM \"AP_INVOICE_PAYMENTS_ALL\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    LEFT JOIN \"AP_CHECKS_ALL\" AS \"AP_CHECKS_ALL\"\n        ON \"AP_INVOICE_PAYMENTS_ALL\".\"CHECK_ID\" = \"AP_CHECKS_ALL\".\"CHECK_ID\"\n    LEFT JOIN \"AP_PAYMENT_SCHEDULES_ALL\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_ID\" || \"AP_INVOICE_PAYMENTS_ALL\".\"PAYMENT_NUM\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"\n    LEFT JOIN \"AP_INVOICES_ALL\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" = \"AP_INVOICES_ALL\".\"INVOICE_ID\"           \nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" IS NOT NULL\n    AND \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" IN ('STANDARD','CREDIT','DEBIT')"
                    }
                ],
                "foreign_key_names": [
                    "CreatedBy",
                    "Vendor",
                    "VendorInvoice"
                ],
                "namespace": "custom",
                "property_names": [
                    "Amount",
                    "BaselineDate",
                    "BusinessUnit",
                    "CashDiscountDueDate1",
                    "CashDiscountDueDate2",
                    "CashDiscountEligibleAmount1",
                    "CashDiscountEligibleAmount2",
                    "CashDiscountTakenAmount",
                    "ClearingDate",
                    "CreationExecutionType",
                    "CreationTime",
                    "Currency",
                    "DebitCreditIndicator",
                    "DocumentCategory",
                    "DocumentDate",
                    "FiscalYear",
                    "ID",
                    "IsBlockedForPayment",
                    "IsPurchaseDocumentRelated",
                    "IsReversed",
                    "ItemNumber",
                    "NetDueDate",
                    "PaymentMethodCode",
                    "PaymentTerms",
                    "ReceiptDate",
                    "Reference",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "PayableItemAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_LastValidation_Time\" AS (\n    SELECT \n        \"XLA_TRANSACTION_ENTITIES\".\"SOURCE_ID_INT_1\"                                     AS \"INVOICE_ID\",\n        ROW_NUMBER() OVER (PARTITION BY \"XLA_TRANSACTION_ENTITIES\".\"SOURCE_ID_INT_1\"\n        ORDER BY \"XLA_EVENTS\".\"CREATION_DATE\" ASC, \"XLA_EVENTS\".\"EVENT_NUMBER\" DESC)     AS \"rn\",\n        CAST(\"XLA_EVENTS\".\"CREATION_DATE\" AS TIMESTAMP)                                  AS \"LastValidationTime\",\n        \"XLA_EVENTS\".\"EVENT_ID\"                                                          AS \"EVENT_ID\",\n        \"XLA_EVENTS\".\"CREATED_BY\"                                                        AS \"CREATED_BY\"\n    FROM \"XLA_TRANSACTION_ENTITIES\" AS \"XLA_TRANSACTION_ENTITIES\"\n        LEFT JOIN \"XLA_EVENTS\" AS \"XLA_EVENTS\"\n            ON \"XLA_TRANSACTION_ENTITIES\".\"APPLICATION_ID\" = \"XLA_EVENTS\".\"APPLICATION_ID\"\n                AND \"XLA_TRANSACTION_ENTITIES\".\"ENTITY_ID\" = \"XLA_EVENTS\".\"ENTITY_ID\"\n    WHERE \"XLA_TRANSACTION_ENTITIES\".\"ENTITY_CODE\" = 'AP_INVOICES'\n        AND \"XLA_TRANSACTION_ENTITIES\".\"APPLICATION_ID\" = 200\n        AND \"XLA_EVENTS\".\"EVENT_STATUS_CODE\" = 'P'\n        AND \"XLA_EVENTS\".\"EVENT_TYPE_CODE\" IN ('INVOICE VALIDATED', 'CREDIT MEMO VALIDATED', 'DEBIT MEMO VALIDATED')\n),                            \n    \"CTE_LastValidation\" AS (\n    SELECT \n        \"LastValTime\".\"INVOICE_ID\"         AS \"INVOICE_ID\",\n        \"LastValTime\".\"LastValidationTime\" AS \"LastValidationTime\",\n        \"LastValTime\".\"CREATED_BY\"         AS \"CREATED_BY\",\n        \"LastValTime\".\"EVENT_ID\"           AS \"EVENT_ID\"\n    FROM \"CTE_LastValidation_Time\" AS \"LastValTime\"\n    WHERE \"LastValTime\".\"rn\" = 1\n),\n    \"CTE_FullValidation\" AS (\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"INVOICE_ID\" AS \"INVOICE_ID\"\n    FROM \"AP_INVOICE_DISTRIBUTIONS_ALL\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n    WHERE \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"POSTED_FLAG\" = 'Y'\n    EXCEPT\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"INVOICE_ID\" AS \"INVOICE_ID\"\n    FROM \"AP_INVOICE_DISTRIBUTIONS_ALL\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n    WHERE \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"POSTED_FLAG\" <> 'Y'\n),\n    \"CTE_PERIOD_LOOKUP\" AS (\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"INVOICE_ID\"              AS \"INVOICE_ID\",\n        MIN(CAST(\"GL_PERIOD_STATUSES\".\"PERIOD_YEAR\" AS INTEGER)) AS \"PERIOD_YEAR\"\n    FROM \"AP_INVOICE_DISTRIBUTIONS_ALL\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n        LEFT JOIN \"GL_PERIOD_STATUSES\" AS \"GL_PERIOD_STATUSES\"\n            ON \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"PERIOD_NAME\" = \"GL_PERIOD_STATUSES\".\"PERIOD_NAME\"\n                AND \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"SET_OF_BOOKS_ID\" = \"GL_PERIOD_STATUSES\".\"SET_OF_BOOKS_ID\"\n    GROUP BY \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"INVOICE_ID\"\n),                          \n\t\"CTE_PORELATED\" AS (\n    SELECT \n        \"AP_INVOICE_LINES_ALL\".\"INVOICE_ID\"                               AS \"INVOICE_ID\",\n        CASE\n            WHEN COUNT(\"AP_INVOICE_LINES_ALL\".\"PO_HEADER_ID\") > 0 \n                THEN 'Y'\n            ELSE 'N' \n        END                                                               AS \"PO_RELATED_FLAG\"\n        FROM \"AP_INVOICE_LINES_ALL\" AS \"AP_INVOICE_LINES_ALL\"\n        GROUP BY \"AP_INVOICE_LINES_ALL\".\"INVOICE_ID\"\n),\n    \"CTE_AGG_INV_PMT\" AS (\n    SELECT \n        \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_ID\"                        AS \"INVOICE_ID\", \n        \"AP_INVOICE_PAYMENTS_ALL\".\"PAYMENT_NUM\"                       AS \"PAYMENT_NUM\" ,\n        COALESCE(SUM(\"AP_INVOICE_PAYMENTS_ALL\".\"DISCOUNT_TAKEN\"), 0)  AS \"DISCOUNT_TAKEN\",\n        COALESCE(SUM(\"AP_INVOICE_PAYMENTS_ALL\".\"DISCOUNT_LOST\"), 0)   AS \"DISCOUNT_LOST\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"CREATION_DATE\")                AS \"LAST_PAYMENT_DATE\"\n    FROM \"AP_INVOICE_PAYMENTS_ALL\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    WHERE (NULLIF(\"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_FLAG\", '') IS NULL\n        OR \"AP_INVOICE_PAYMENTS_ALL\".\"REVERSAL_FLAG\" = 'N')\n    GROUP BY \"AP_INVOICE_PAYMENTS_ALL\".\"INVOICE_ID\", \"AP_INVOICE_PAYMENTS_ALL\".\"PAYMENT_NUM\"\n)\nSELECT \n    <%=sourceSystem%>  || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\"                                                             AS \"ID\",\n    <%=sourceSystem%>  || '::' || \"LastValidation\".\"CREATED_BY\"                                                         AS \"CreatedBy\",\n    <%=sourceSystem%>  || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\"                                               AS \"VendorInvoice\",\n    <%=sourceSystem%>  || '::' || \"AP_INVOICES_ALL\".\"VENDOR_ID\"                                                         AS \"Vendor\",\n    \"LastValidation\".\"LastValidationTime\"                                                                               AS \"CreationTime\",\n    CAST(\"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" AS VARCHAR(255))                                                      AS \"ItemNumber\",\n    \"PERIOD_LOOKUP\".\"PERIOD_YEAR\"                                                                                       AS \"FiscalYear\",\n    CASE\n        WHEN \"AP_INVOICES_ALL\".\"SOURCE\" = 'Manual Invoice Entry'\n            THEN 'Manual'\n        ELSE 'Automatic'\n    END                                                                                                                 AS \"CreationExecutionType\",\n\t\"AP_INVOICES_ALL\".\"INVOICE_CURRENCY_CODE\"                                                                           AS \"Currency\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"DISCOUNT_AMOUNT_AVAILABLE\"                                                              AS \"CashDiscountEligibleAmount1\",\n    \"AP_PAYMENT_SCHEDULES_ALL\".\"SECOND_DISC_AMT_AVAILABLE\"                                                              AS \"CashDiscountEligibleAmount2\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"INV_CURR_GROSS_AMOUNT\"                                                                  AS \"Amount\",\n\t\"TERMS\".\"NAME\"                                                                                                      AS \"PaymentTerms\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_METHOD_CODE\"                                                                    AS \"PaymentMethodCode\",\n    CASE\n        WHEN \"AP_INVOICES_ALL\".\"PAYMENT_STATUS_FLAG\" = 'Y'\n            THEN \"AGG_INV_PMT\".\"LAST_PAYMENT_DATE\" \n    END                                                                                                                 AS \"ClearingDate\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"DISCOUNT_DATE\"                                                                          AS \"CashDiscountDueDate1\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"SECOND_DISCOUNT_DATE\"                                                                   AS \"CashDiscountDueDate2\",\n\t\"AP_PAYMENT_SCHEDULES_ALL\".\"DUE_DATE\"                                                                               AS \"NetDueDate\",\n\t\"AP_INVOICES_ALL\".\"TERMS_DATE\"                                                                                      AS \"BaselineDate\",\n\t\"AP_INVOICES_ALL\".\"INVOICE_DATE\"                                                                                    AS \"DocumentDate\",\n\t\"AP_INVOICES_ALL\".\"INVOICE_NUM\"                                                                                     AS \"Reference\",\n\tCASE \n\t\tWHEN \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" = 'STANDARD' \n            THEN 'InvoiceItem'\n\t\tWHEN \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" = 'CREDIT' \n            THEN 'CreditMemoItem'\n        WHEN \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" = 'DEBIT' \n            THEN 'DebitMemoItem'\n\t\tELSE 'Other'\n    END                                                                                                                 AS \"DocumentCategory\",\n\tCASE \n\t\tWHEN \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" = 'STANDARD' \n            THEN 'Credit'\n\t\tWHEN \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" IN ('CREDIT','DEBIT') \n            THEN 'Debit'\n\t\tELSE 'Other'\n    END                                                                                                                 AS \"DebitCreditIndicator\",\n\tCASE\n\t\tWHEN \"AP_PAYMENT_SCHEDULES_ALL\".\"HOLD_FLAG\" = 'Y' \n            THEN TRUE \n\t\tELSE FALSE \n\tEND                                                                                                                 AS \"IsBlockedForPayment\",\n\tCASE\n        WHEN \"AP_INVOICES_ALL\".\"CANCELLED_DATE\" IS NOT NULL\n            THEN TRUE\n        ELSE FALSE\n    END                                                                                                                 AS \"IsReversed\",\n\tCASE\n        WHEN \"PO_RELATED\".\"PO_RELATED_FLAG\" = 'Y'\n            THEN TRUE\n        ELSE FALSE\n    END                                                                                                                 AS \"IsPurchaseDocumentRelated\",\n    COALESCE(\"AGG_INV_PMT\".\"DISCOUNT_TAKEN\", 0)                                                                         AS \"CashDiscountTakenAmount\",\n\t\"AP_INVOICES_ALL\".\"INVOICE_RECEIVED_DATE\"                                                                           AS \"ReceiptDate\",\n    \"HR_ALL_ORGANIZATION_UNITS\".\"NAME\"                                                                                  AS \"BusinessUnit\",\n    <%=sourceSystem%>                                                                                                   AS \"SourceSystemInstance\"\nFROM \"AP_PAYMENT_SCHEDULES_ALL\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n    LEFT JOIN \"AP_INVOICES_ALL\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" = \"AP_INVOICES_ALL\".\"INVOICE_ID\"\n    LEFT JOIN \"HR_ALL_ORGANIZATION_UNITS\" AS \"HR_ALL_ORGANIZATION_UNITS\"\n        ON \"AP_INVOICES_ALL\".\"ORG_ID\" = \"HR_ALL_ORGANIZATION_UNITS\".\"ORGANIZATION_ID\"\n    LEFT JOIN \"CTE_PERIOD_LOOKUP\" AS \"PERIOD_LOOKUP\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" = \"PERIOD_LOOKUP\".\"INVOICE_ID\"          \n    LEFT JOIN \"CTE_PORELATED\" AS \"PO_RELATED\"\n        ON \"AP_INVOICES_ALL\".\"INVOICE_ID\" = \"PO_RELATED\".\"INVOICE_ID\"\n    LEFT JOIN \"AP_TERMS_TL\" AS \"TERMS\"\n        ON \"AP_INVOICES_ALL\".\"TERMS_ID\" = \"TERMS\".\"TERM_ID\"\n            AND \"TERMS\".\"LANGUAGE\" = <%=languageKey%> \n    LEFT JOIN \"CTE_LastValidation\" AS \"LastValidation\"\n        ON \"AP_INVOICES_ALL\".\"INVOICE_ID\" = \"LastValidation\".\"INVOICE_ID\"\n    LEFT JOIN \"CTE_FullValidation\" AS \"FullValidation\"\n        ON \"AP_INVOICES_ALL\".\"INVOICE_ID\" = \"FullValidation\".\"INVOICE_ID\"\n    LEFT JOIN \"CTE_AGG_INV_PMT\" AS \"AGG_INV_PMT\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"INVOICE_ID\" = \"AGG_INV_PMT\".\"INVOICE_ID\"\n            AND \"AP_PAYMENT_SCHEDULES_ALL\".\"PAYMENT_NUM\" = \"AGG_INV_PMT\".\"PAYMENT_NUM\"\nWHERE \"AP_INVOICES_ALL\".\"INVOICE_TYPE_LOOKUP_CODE\" IN ('STANDARD','CREDIT','DEBIT')\n    AND \"LastValidation\".\"INVOICE_ID\" IS NOT NULL\n    AND \"FullValidation\".\"INVOICE_ID\" IS NOT NULL"
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1764069002669.0,
        "changed_by": {
            "id": "af10323b-7030-4dbe-af1b-cbf71f532c06",
            "name": "l.lutz",
            "type_": "USER"
        },
        "created_by": {
            "id": "8b0fa45b-28fe-4314-bf39-c9e18042a5f4",
            "name": "Johannes Muhr",
            "type_": "USER"
        },
        "creation_date": 1753883436644.0,
        "data_connection_id": "8939ad05-4472-435c-a065-ed31be1b9fea",
        "description": null,
        "disabled": null,
        "display_name": "PayableItem - SAP S/4 HANA",
        "draft": null,
        "factory_id": "ed649941-bc47-4ca2-9cc0-ce80b2bb96ba",
        "factory_validation_status": "VALID",
        "has_user_template": true,
        "local_parameters": [
            {
                "name": "sourceSystem",
                "value": "'SAP_S4_HANA'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "PayableItem",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [
                    {
                        "id": "Changes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\n\t<%=sourceSystem%> || '::'|| \"CDPOS\".\"TABKEY\" || '::' || \"CDPOS\".\"TABNAME\" \n        || '::' || \"CDPOS\".\"FNAME\" || '::' || \"CDPOS\".\"CHANGENR\" \n        || '::' || \"CDPOS\".\"CHNGIND\"                                            AS \"ID\",\n    <%=sourceSystem%> || '::' || \n        SUBSTRING(\"CDPOS\".\"TABKEY\", 1, 3)  || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 4, 4)  || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 8, 10) || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 18, 4) || '::' ||\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 22, 3)                                      AS \"ObjectID\", \n    CAST(\"CDHDR\".\"UDATE\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, \n        CAST(\"CDHDR\".\"UTIME\" AS DATE), \"CDHDR\".\"UTIME\") AS INTERVAL SECOND)     AS \"Time\",\n\tCASE\n           WHEN \"CDPOS\".\"FNAME\" = 'SGTXT' THEN 'ItemText'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZFBDT' THEN 'BaseLineDate'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD1T' THEN 'PaymentDays1'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD2T' THEN 'PaymentDays2'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD3T' THEN 'PaymentDays3'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD1P' THEN 'DiscountPercentage1'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZBD2P' THEN 'DiscountPercentage2'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSCH' THEN 'PaymentMethod'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZTERM' THEN 'PaymentTerms'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_NEW\", '') IS NULL  THEN 'ReleasePaymentBlock'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_OLD\", '') IS NULL  THEN 'SetPaymentBlock'\n           WHEN \"CDPOS\".\"FNAME\" = 'ZLSPR' \n                AND NULLIF(\"CDPOS\".\"VALUE_OLD\", '') IS NOT NULL \n                AND NULLIF(\"CDPOS\".\"VALUE_NEW\", '') IS NOT NULL  THEN 'PaymentBlock'\n     END                                                                        AS \"Attribute\",\n\tCASE\n        WHEN \"CDPOS\".\"VALUE_OLD\" LIKE '%-' \n            THEN CONCAT('-',REPLACE(LTRIM(\"CDPOS\".\"VALUE_OLD\"), '-', ''))\n        ELSE \"CDPOS\".\"VALUE_OLD\" \n     END                                                                        AS \"OldValue\",\n\tCASE\n        WHEN \"CDPOS\".\"VALUE_NEW\" LIKE '%-' \n            THEN CONCAT('-', REPLACE(LTRIM(\"CDPOS\".\"VALUE_NEW\"), '-', ''))\n        ELSE \"CDPOS\".\"VALUE_NEW\"\n     END                                                                        AS \"NewValue\",\n\t<%=sourceSystem%>  || '::' || \"CDHDR\".\"MANDANT\" \n        || '::' || \"CDHDR\".\"USERNAME\"                                           AS \"ChangedBy\",\n\t\"CDHDR\".\"TCODE\"                                                             AS \"OperationType\",\n\t<%=sourceSystem%>  || '::' || \"CDHDR\".\"CHANGENR\"                            AS \"OperationID\",\n\tCASE\n        WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic'\n        ELSE 'Manual' \n     END                                                                        AS \"ExecutionType\"\nFROM \"CDPOS\" AS \"CDPOS\"\n         LEFT JOIN \"CDHDR\" AS \"CDHDR\"\n                   ON \"CDPOS\".\"MANDANT\" = \"CDHDR\".\"MANDANT\"\n                       AND \"CDPOS\".\"OBJECTCLAS\" = \"CDHDR\".\"OBJECTCLAS\"\n                       AND \"CDPOS\".\"ObjectID\" = \"CDHDR\".\"ObjectID\"\n                       AND \"CDPOS\".\"CHANGENR\" = \"CDHDR\".\"CHANGENR\"\n                       AND \"CDPOS\".\"OBJECTCLAS\" = 'BELEG'\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"CDHDR\".\"USERNAME\" = \"USR02\".\"BNAME\"\n                       AND \"CDHDR\".\"MANDANT\" = \"USR02\".\"MANDT\"\nWHERE \"CDPOS\".\"TABNAME\" IN ('BSEG')\n  AND \"CDPOS\".\"FNAME\" IN ('SGTXT', 'ZFBDT', 'ZTERM', 'ZLSCH', 'ZLSPR', 'ZBD1T', 'ZBD2T', 'ZBD3T', 'ZBD1P', 'ZBD2P')\n  AND \"CDPOS\".\"CHNGIND\" = 'U'\n  AND NULLIF(\"CDPOS\".\"MANDANT\", '') IS NOT NULL\n  AND NULLIF(\"CDHDR\".\"MANDANT\", '') IS NOT NULL\n"
                    },
                    {
                        "id": "Clearing",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\n    'Clearing' || \n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"BUKRS\" \n            ||  '::'  ||\"BKPF\".\"BELNR\"|| '::' ||  \"BKPF\".\"GJAHR\" \n        ELSE <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" || '::' ||  \"BSEG\".\"BUKRS\" \n            ||'::' ||  \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n     END \n      -- concatenating with object ID to make it unique\n     || '::' || \n    <%=sourceSystem%>  || '::'|| \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\" || '::' || \"BSEG\".\"BUZEI\"                           AS \"ID\",\n    <%=sourceSystem%>  || '::'|| \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\" || '::' || \"BSEG\".\"BUZEI\"                           AS \"ObjectID\",\n    CASE\n\t    WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN CAST(\"BKPF\".\"CPUDT\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND) \n        ELSE CAST(\"BSEG\".\"AUGDT\" AS DATE) + INTERVAL '86399' SECOND\n     END                                                                                                        AS \"Time\",\n    'Clearing'                                                                                                  AS \"Attribute\",\n    NULL                                                                                                        AS \"OldValue\", \n    NULL                                                                                                        AS \"NewValue\",\n    CASE\n\t    WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"USNAM\"\n        ELSE NULL \n     END                                                                                                        AS \"ChangedBy\",\n    NULL                                                                                                        AS \"OperationType\",\n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL\n            THEN <%=sourceSystem%> || '::'|| \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"BUKRS\" \n            || '::' || \"BKPF\".\"BELNR\"|| '::' || \"BKPF\".\"GJAHR\" \n        WHEN \"BSEG\".\"AUGGJ\" <> '0000'\n            THEN <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" ||'::' ||  \"BSEG\".\"BUKRS\" \n            || '::' || \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n        ELSE <%=sourceSystem%> || '::'|| \"BSEG\".\"MANDT\" ||'::' ||  \"BSEG\".\"BUKRS\" \n            || '::' || \"BSEG\".\"AUGBL\" || '::' || \"BSEG\".\"AUGGJ\" \n            || '::' || \"BSEG\".\"BELNR\" || '::' || \"BSEG\".\"GJAHR\"|| '::' || \"BSEG\".\"BUZEI\"  -- workaround to avoid duplicates\n     END                                                                                                        AS  \"OperationID\",\n    CASE\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL AND \"USR02\".\"USTYP\" IN ('B', 'C')\n\t        THEN 'Automatic'\n        WHEN NULLIF(\"BKPF\".\"MANDT\", '') IS NOT NULL AND \"USR02\".\"USTYP\" NOT IN ('B', 'C')\n            THEN 'Manual' \n        ELSE NULL\n     END                                                                                                        AS \"ExecutionType\"\nFROM \"BSEG\" AS \"BSEG\"\n         LEFT JOIN \"BKPF\" AS \"BKPF\"\n                   ON \"BSEG\".\"MANDT\" = \"BKPF\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n                       AND \"BSEG\".\"AUGBL\" = \"BKPF\".\"BELNR\"\n                       AND \"BSEG\".\"AUGGJ\" = \"BKPF\".\"GJAHR\"\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n                       AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\nWHERE \"BSEG\".\"KOART\" = 'K'\n    AND NULLIF(\"BSEG\".\"AUGBL\", '') IS NOT NULL\n    AND \"BSEG\".\"BSCHL\" IN ('21','31')\n"
                    },
                    {
                        "id": "Payment",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT DISTINCT \n    'Payment' || \n    <%=sourceSystem%> || '::'|| \"BSEG_PAYMENT\".\"MANDT\" || '::' || \"BSEG_PAYMENT\".\"BUKRS\" \n        || '::' || \"BSEG_PAYMENT\".\"BELNR\" || '::' || \"BSEG_PAYMENT\".\"GJAHR\" \n        || '::' || \"BSEG_PAYMENT\".\"BUZEI\"  \n        -- concatenating with object ID to make it unique\n        || '::'  \n        || <%=sourceSystem%> || '::' || \"BSEG_PAYABLE_ITEM\".\"MANDT\" \n        || '::' ||  \"BSEG_PAYABLE_ITEM\".\"BUKRS\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BELNR\" || '::' || \"BSEG_PAYABLE_ITEM\".\"GJAHR\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BUZEI\"                                              AS \"ID\",\n    <%=sourceSystem%> || '::' || \"BSEG_PAYABLE_ITEM\".\"MANDT\" || '::' || \"BSEG_PAYABLE_ITEM\".\"BUKRS\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BELNR\" || '::' || \"BSEG_PAYABLE_ITEM\".\"GJAHR\" \n        || '::' || \"BSEG_PAYABLE_ITEM\".\"BUZEI\"                                              AS \"ObjectID\",\n    CAST(\n        CAST(\"BKPF\".\"CPUDT\" AS DATE) + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND) AS TIMESTAMP)                       AS \"Time\",\n    'Payment'                                                                               AS \"Attribute\",\n\tNULL                                                                                    AS \"OldValue\",\n\tNULL                                                                                    AS \"NewValue\", \n    <%=sourceSystem%> || '::' || \"BKPF\".\"MANDT\"  || '::' || \"BKPF\".\"USNAM\"                  AS \"ChangedBy\",\n    NULL                                                                                    AS \"OperationType\",\n    <%=sourceSystem%> || '::' || \"BSEG_PAYMENT\".\"MANDT\" || '::' || \"BSEG_PAYMENT\".\"BUKRS\" \n        || '::' || \"BSEG_PAYMENT\".\"BELNR\" || '::' || \"BSEG_PAYMENT\".\"GJAHR\" \n        || '::' || \"BSEG_PAYMENT\".\"BUZEI\"                                                   AS \"OperationID\", \n    CASE \n        WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic'\n        ELSE 'Manual' \n     END                                                                                    AS \"ExecutionType\"\nFROM \"BKPF\" AS \"BKPF\"\n    INNER JOIN \"BSEG\" AS \"BSEG_PAYMENT\" \n        ON \"BKPF\".\"MANDT\" = \"BSEG_PAYMENT\".\"MANDT\"\n            AND \"BKPF\".\"BUKRS\" = \"BSEG_PAYMENT\".\"BUKRS\"\n            AND \"BKPF\".\"BELNR\" = \"BSEG_PAYMENT\".\"BELNR\"\n            AND \"BKPF\".\"GJAHR\" = \"BSEG_PAYMENT\".\"GJAHR\"\n    LEFT JOIN \"BSEG\" AS \"BSEG_PAYABLE_ITEM\"\n        ON  \"BSEG_PAYABLE_ITEM\".\"MANDT\" = \"BKPF\".\"MANDT\"\n            AND \"BSEG_PAYABLE_ITEM\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n            AND \"BSEG_PAYABLE_ITEM\".\"AUGBL\" = \"BKPF\".\"BELNR\"\n            AND \"BSEG_PAYABLE_ITEM\".\"AUGGJ\" = \"BKPF\".\"GJAHR\"\n    LEFT JOIN \"USR02\" AS \"USR02\"\n        ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n            AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\nWHERE NULLIF(\"BSEG_PAYMENT\".\"MANDT\", '') IS NOT NULL\n    AND \"BSEG_PAYMENT\".\"BSCHL\" IN ('25','26')\n    AND \"BSEG_PAYABLE_ITEM\".\"BSCHL\" IN ('31')"
                    }
                ],
                "foreign_key_names": [
                    "CreatedBy",
                    "Vendor",
                    "VendorInvoice"
                ],
                "namespace": "custom",
                "property_names": [
                    "Amount",
                    "BaselineDate",
                    "BusinessUnit",
                    "CashDiscountDueDate1",
                    "CashDiscountDueDate2",
                    "CashDiscountEligibleAmount1",
                    "CashDiscountEligibleAmount2",
                    "CashDiscountTakenAmount",
                    "ClearingDate",
                    "CreationExecutionType",
                    "CreationTime",
                    "Currency",
                    "DebitCreditIndicator",
                    "DocumentCategory",
                    "DocumentDate",
                    "FiscalYear",
                    "ID",
                    "IsBlockedForPayment",
                    "IsPurchaseDocumentRelated",
                    "IsReversed",
                    "ItemNumber",
                    "NetDueDate",
                    "PaymentMethodCode",
                    "PaymentTerms",
                    "ReceiptDate",
                    "Reference",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "PayableItemAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT\t\n    <%=sourceSystem%> || '::' || \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"BUKRS\" \n        || '::' ||\"BSEG\".\"BELNR\" || '::' ||\"BSEG\".\"GJAHR\" \n        || '::' || \"BSEG\".\"BUZEI\"                                               AS \"ID\",\n    <%=sourceSystem%> || '::' || \"BKPF\".\"MANDT\" || '::' || \"BKPF\".\"USNAM\"       AS \"CreatedBy\",\n    <%=sourceSystem%> || '::' || \"RBKP\".\"MANDT\" || '::' ||\"RBKP\".\"BELNR\" \n        || '::' ||\"RBKP\".\"GJAHR\"                                                AS \"VendorInvoice\",\n    <%=sourceSystem%> || '::' || \"BSEG\".\"MANDT\" || '::' || \"BSEG\".\"LIFNR\"       AS \"Vendor\",\n\tCAST(\"BKPF\".\"GJAHR\" AS BIGINT)                                              AS \"FiscalYear\",\n\tCAST(\"BSEG\".\"BUZEI\" AS VARCHAR(255))                                        AS \"ItemNumber\",\n    CAST(\"BKPF\".\"CPUDT\" AS DATE) \n        + CAST(TIMESTAMPDIFF(SECOND, CAST(\"BKPF\".\"CPUTM\" AS DATE), \n                    \"BKPF\".\"CPUTM\") AS INTERVAL SECOND)                         AS \"CreationTime\",\n\tCAST(\"BKPF\".\"REINDAT\" AS TIMESTAMP)                                         AS \"ReceiptDate\",\n\tCASE\n        WHEN \"BKPF\".\"AWTYP\" = 'RMRP' THEN TRUE\n           ELSE FALSE \n     END                                                                        AS \"IsPurchaseDocumentRelated\",\n\tCASE\n        WHEN NULLIF(\"BKPF\".\"XREVERSAL\", '') IS NOT NULL \n            THEN TRUE\n        WHEN \"BSEG\".\"BSCHL\" IN ('21','31') AND \"BKPF\".\"TCODE\" = 'MR8M'\n            THEN TRUE\n        WHEN NULLIF(\"RBKP\".\"STBLG\", '') IS NOT NULL \n            THEN TRUE \n        ELSE FALSE\n     END                                                                        AS \"IsReversed\",\n\tCASE WHEN NULLIF(\"BSEG\".\"ZLSPR\", '') IS NOT NULL THEN TRUE ELSE FALSE END   AS \"IsBlockedForPayment\",\n\tCASE\n       WHEN \"BSEG\".\"SHKZG\" = 'H' THEN 'Credit' \n       WHEN \"BSEG\".\"SHKZG\" = 'S' THEN 'Debit' \n       ELSE 'Other'\n     END                                                                        AS \"DebitCreditIndicator\",\n\tCASE\n       WHEN \"BSEG\".\"BSCHL\" = '21' AND \"BKPF\".\"TCODE\" = 'MR8M'\n           THEN 'CreditMemoItem - ReversalDocument' \n       WHEN \"BSEG\".\"BSCHL\" = '21' \n         THEN 'CreditMemoItem'\n       WHEN \"BSEG\".\"BSCHL\" = '31' AND \"BKPF\".\"TCODE\" = 'MR8M'\n           THEN 'InvoiceItem - ReversalDocument' \n       WHEN \"BSEG\".\"BSCHL\" = '31' \n           THEN 'InvoiceItem' \n       ELSE 'Other'\n     END                                                                        AS \"DocumentCategory\",\n\t\"BKPF\".\"XBLNR\"                                                              AS \"Reference\",\n\tCAST(\"BKPF\".\"BLDAT\" AS TIMESTAMP)                                           AS \"DocumentDate\",\n\tCAST(\"BSEG\".\"ZFBDT\" AS TIMESTAMP)                                           AS \"BaselineDate\",\n\tCASE\n       WHEN \"BSEG\".\"ZBD3T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD3T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       WHEN \"BSEG\".\"ZBD3T\" = 0 AND \"BSEG\".\"ZBD2T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD2T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       WHEN \"BSEG\".\"ZBD3T\" = 0 AND \"BSEG\".\"ZBD2T\" = 0\n            AND \"BSEG\".\"ZBD1T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD1T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       ELSE CAST(\"BSEG\".\"ZFBDT\" AS TIMESTAMP) + INTERVAL '86399' SECOND\n       END                                                                      AS \"NetDueDate\",\n\tCASE\n       WHEN  \"BSEG\".\"ZBD2P\" > 0 AND \"BSEG\".\"ZBD2T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD2T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       END                                                                      AS \"CashDiscountDueDate2\",\n\tCASE\n       WHEN  \"BSEG\".\"ZBD1P\" > 0 AND \"BSEG\".\"ZBD1T\" > 0\n           THEN\n               CAST((CAST(\"BSEG\".\"ZFBDT\" AS DATE)\n                     + \"BSEG\".\"ZBD1T\" * INTERVAL '1' DAY) AS DATE) + INTERVAL '86399' SECOND\n       END                                                                      AS \"CashDiscountDueDate1\",\n\t\"BSEG\".\"ZLSCH\"                                                              AS \"PaymentMethodCode\",\n\tCAST(\"BSEG\".\"AUGDT\" AS TIMESTAMP)                                           AS \"ClearingDate\",\n    \"BSEG\".\"ZTERM\"                                                              AS \"PaymentTerms\",\n\t\"BSEG\".\"WRBTR\" *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"Amount\",\n    \"BSEG\".\"WSKTO\"   *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountTakenAmount\",\n\t\"BSEG\".\"SKFBT\" * \"BSEG\".\"ZBD2P\" / 100  *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountEligibleAmount2\",\n\t\"BSEG\".\"SKFBT\" * \"BSEG\".\"ZBD1P\" / 100 *\n        CASE\n            WHEN \"BSEG\".\"SHKZG\" = 'S' THEN -1.0\n            ELSE 1.0\n        END                                                                     AS \"CashDiscountEligibleAmount1\",\n\t\"BKPF\".\"WAERS\"                                                              AS \"Currency\",\n    \"BSEG\".\"BUKRS\" || ' - ' || \"T001\".\"BUTXT\"                                   AS \"BusinessUnit\",\n    CASE WHEN \"USR02\".\"USTYP\" IN ('B', 'C') THEN 'Automatic' ELSE 'Manual' END  AS \"CreationExecutionType\",\n\t<%=sourceSystem%>  || '::' || \"BSEG\".\"MANDT\"                                AS \"SourceSystemInstance\"\nFROM \"BSEG\" AS \"BSEG\"\n         LEFT JOIN \"BKPF\" AS \"BKPF\"\n                   ON \"BSEG\".\"MANDT\" = \"BKPF\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"BKPF\".\"BUKRS\"\n                       AND \"BSEG\".\"BELNR\" = \"BKPF\".\"BELNR\"\n                       AND \"BSEG\".\"GJAHR\" = \"BKPF\".\"GJAHR\"\n         LEFT JOIN \"RBKP\" AS \"RBKP\"\n                   ON \"BKPF\".\"MANDT\" = \"RBKP\".\"MANDT\"\n                       AND \"BKPF\".\"BUKRS\" = \"RBKP\".\"BUKRS\"\n                       AND \"BKPF\".\"AWKEY\" = \"RBKP\".\"BELNR\" || \"RBKP\".\"GJAHR\"\n         LEFT JOIN \"USR02\" AS \"USR02\"\n                   ON \"BKPF\".\"MANDT\" = \"USR02\".\"MANDT\"\n                       AND \"BKPF\".\"USNAM\" = \"USR02\".\"BNAME\"\n         LEFT JOIN \"T001\" AS \"T001\"\n                   ON \"BSEG\".\"MANDT\" = \"T001\".\"MANDT\"\n                       AND \"BSEG\".\"BUKRS\" = \"T001\".\"BUKRS\"\nWHERE NULLIF(\"BSEG\".\"MANDT\", '') IS NOT NULL\n    AND \"BSEG\".\"BSCHL\" IN ('21','31')  "
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1761757555975.0,
        "changed_by": {
            "id": "8b0fa45b-28fe-4314-bf39-c9e18042a5f4",
            "name": "Johannes Muhr",
            "type_": "USER"
        },
        "created_by": {
            "id": "2589b288-6fa5-4412-b75b-180b8acb07d0",
            "name": "Carolina Ventura",
            "type_": "USER"
        },
        "creation_date": 1750236231125.0,
        "data_connection_id": "03736e95-3931-4eda-8dfe-fc16e11388bc",
        "description": null,
        "disabled": null,
        "display_name": "PayableItem - 00. Central Extraction Pool_Oracle Fusion",
        "draft": null,
        "factory_id": "d103bc32-7816-44db-a51e-110de7cdd02a",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "languageKey",
                "value": "'US'"
            },
            {
                "name": "sourceSystem",
                "value": "'Oracle_Fusion'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "PayableItem",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [
                    {
                        "id": "Changes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT \n    <%=sourceSystem%> || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\"\n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"DATE\"                                                AS \"ID\",\n    <%=sourceSystem%> || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"                                       AS \"ObjectID\",            \n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"DATE\"                                                               AS \"Time\",\n    CASE\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllPaymentMethodCode' \n            THEN 'PaymentMethod'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllDueDate' \n            THEN 'DueDate'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllDiscountDate' \n            THEN 'DiscountDate1'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllSecondDiscountDate' \n            THEN 'DiscountDate2'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllDiscountAmountAvailable' \n            THEN 'DiscountAmount1'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllSecondDiscAmtAvailable' \n            THEN 'DiscountAmount2'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllGrossAmount' \n            THEN 'InvoiceGrossAmount'\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllHoldFlag' \n            AND AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG.\"NEW_VALUE\" = 'N' \n                THEN 'ReleasePaymentBlock' \n        WHEN \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" = 'ApPaymentSchedulesAllHoldFlag' \n            AND AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG.\"NEW_VALUE\" = 'Y'  \n                THEN 'SetPaymentBlock' \n    END                                                                                                               AS \"Attribute\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"OLD_VALUE\"                                                          AS \"OldValue\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"NEW_VALUE\"                                                          AS \"NewValue\",\n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"USER\"                                   AS \"ChangedBy\",\n    \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"TYPE\"                                                               AS \"OperationType\",\n    NULL                                                                                                              AS \"OperationID\", \n    NULL                                                                                                              AS \"ExecutionType\"\nFROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoicePaymentScheduleExtractPVO_CELONIS_CHANGELOG\" AS \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoicePaymentScheduleExtractPVO\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"ID\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"\nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" IS NOT NULL\n    AND \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"COLUMN\" IN ('ApPaymentSchedulesAllPaymentMethodCode', 'ApPaymentSchedulesAllHoldFlag',\n           'ApPaymentSchedulesAllDueDate','ApPaymentSchedulesAllDiscountDate', 'ApPaymentSchedulesAllSecondDiscountDate','ApPaymentSchedulesAllDiscountAmountAvailable', 'ApPaymentSchedulesAllSecondDiscAmtAvailable','ApPaymentSchedulesAllGrossAmount')\n    AND \"AP_PAYMENT_SCHEDULES_ALL_CELONIS_CHANGELOG\".\"TYPE\" = 'update'  "
                    },
                    {
                        "id": "Clearing",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_AGG_INV_PMT\" AS (\n    SELECT \n        \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\"                       AS \"INVOICE_ID\",\n        \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllPaymentNum\"                      AS \"PAYMENT_NUM\" ,\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllCreationDate\")               AS \"PAYMENT_DATE\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllCheckId\")                    AS \"PAYMENT_ID\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\")                  AS \"INVOICE_PAYMENT_ID\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_PaidDisbursementScheduleExtractPVO\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    WHERE (NULLIF(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalFlag\", '') IS NULL\n            OR \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalFlag\" = 'N')\n    GROUP BY \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\", \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllPaymentNum\" \n)\nSELECT \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" \n        ||  '::' || 'CLEARING' || '::' || \"AGG_INV_PMT\".\"INVOICE_PAYMENT_ID\"                                           AS \"ID\",\n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"                                        AS \"ObjectID\",            \n    \"AP_CHECKS_ALL\".\"ApChecksAllCreationDate\"                                                                          AS \"Time\",\n    'Clearing'                                                                                                         AS \"Attribute\",\n    NULL                                                                                                               AS \"OldValue\",\n    CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCreationDate\"  AS VARCHAR(255))                                                   AS \"NewValue\",\n    <%=sourceSystem%> || '::' || CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCreatedBy\" AS VARCHAR(255))                          AS \"ChangedBy\",\n    NULL                                                                                                               AS \"OperationType\",\n    <%=sourceSystem%> || '::' || CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCheckId\" AS VARCHAR(255))                            AS \"OperationID\",\n    CASE\n        WHEN \"AP_CHECKS_ALL\".\"ApChecksAllPaymentTypeFlag\" = 'A'\n            THEN 'Automatic'\n        ELSE 'Manual'\n    END                                                                                                                AS \"ExecutionType\" \nFROM \"CTE_AGG_INV_PMT\" AS \"AGG_INV_PMT\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoicePaymentScheduleExtractPVO\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AGG_INV_PMT\".\"INVOICE_ID\" || \"AGG_INV_PMT\".\"PAYMENT_NUM\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" \n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_DisbursementHeaderExtractPVO\" AS \"AP_CHECKS_ALL\"\n        ON \"AGG_INV_PMT\".\"PAYMENT_ID\" = \"AP_CHECKS_ALL\".\"ApChecksAllCheckId\"     \n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceHeaderExtractPVO\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" = \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\"           \nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" IS NOT NULL\n    AND \"AP_CHECKS_ALL\".\"ApChecksAllVoidDate\" IS NULL\n    AND \"AP_INVOICES_ALL\".\"ApInvoicesPaymentStatusFlag\" = 'Y'\n    AND \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" IN ('STANDARD','CREDIT','DEBIT')"
                    },
                    {
                        "id": "Payment",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "SELECT \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" \n        ||  '::' || 'PAYMENT' || '::' || \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoicePaymentId\"             AS \"ID\",       \n    <%=sourceSystem%> || '::'|| \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"                                       AS \"ObjectID\",     \n    \"AP_CHECKS_ALL\".\"ApChecksAllCreationDate\"                                                                         AS \"Time\",\n    CASE \n        WHEN \"AP_CHECKS_ALL\".\"ApChecksAllVoidDate\" IS NOT NULL AND \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalInvPmtId\" IS NOT NULL \n            THEN 'ReversalPayment'\n        WHEN \"AP_CHECKS_ALL\".\"ApChecksAllVoidDate\" IS NOT NULL AND \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalInvPmtId\" IS NULL \n            THEN 'ReversedPayment'\n        WHEN \"AP_CHECKS_ALL\".\"ApChecksAllVoidDate\" IS NULL \n            THEN 'Payment'\n        ELSE 'Other' \n    END                                                                                                               AS \"Attribute\",                                                                                               \n    NULL                                                                                                              AS \"OldValue\",\n    CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCreationDate\"  AS VARCHAR(255))                                                  AS \"NewValue\",\n    <%=sourceSystem%> || '::'|| CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCreatedBy\" AS VARCHAR(255))                          AS \"ChangedBy\",\n    NULL                                                                                                              AS \"OperationType\",\n    <%=sourceSystem%> || '::'|| CAST(\"AP_CHECKS_ALL\".\"ApChecksAllCheckId\" AS VARCHAR(255))                            AS \"OperationID\",\n    CASE\n        WHEN \"AP_CHECKS_ALL\".\"ApChecksAllPaymentTypeFlag\" = 'A'\n            THEN 'Automatic'\n        ELSE 'Manual'\n    END                                                                                                               AS \"ExecutionType\" \nFROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_PaidDisbursementScheduleExtractPVO\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_DisbursementHeaderExtractPVO\" AS \"AP_CHECKS_ALL\"\n        ON \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllCheckId\" = \"AP_CHECKS_ALL\".\"ApChecksAllCheckId\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoicePaymentScheduleExtractPVO\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n        ON \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\" || \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllPaymentNum\" = \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceHeaderExtractPVO\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" = \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\"           \nWHERE \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" IS NOT NULL\n    AND \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" IN ('STANDARD','CREDIT','DEBIT')"
                    }
                ],
                "foreign_key_names": [
                    "CreatedBy",
                    "Vendor",
                    "VendorInvoice"
                ],
                "namespace": "custom",
                "property_names": [
                    "Amount",
                    "BaselineDate",
                    "BusinessUnit",
                    "CashDiscountDueDate1",
                    "CashDiscountDueDate2",
                    "CashDiscountEligibleAmount1",
                    "CashDiscountEligibleAmount2",
                    "CashDiscountTakenAmount",
                    "ClearingDate",
                    "CreationExecutionType",
                    "CreationTime",
                    "Currency",
                    "DebitCreditIndicator",
                    "DocumentCategory",
                    "DocumentDate",
                    "FiscalYear",
                    "ID",
                    "IsBlockedForPayment",
                    "IsPurchaseDocumentRelated",
                    "IsReversed",
                    "ItemNumber",
                    "NetDueDate",
                    "PaymentMethodCode",
                    "PaymentTerms",
                    "ReceiptDate",
                    "Reference",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "PayableItemAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_LastValidation_Time\" AS (\n    SELECT \n        \"XLA_TRANSACTION_ENTITIES\".\"TransactionSourceIdInt1\"                                           AS \"INVOICE_ID\",\n        ROW_NUMBER() OVER (PARTITION BY \"XLA_TRANSACTION_ENTITIES\".\"TransactionSourceIdInt1\"\n        ORDER BY \"XLA_EVENTS\".\"EventPEOCreationDate\" ASC, \"XLA_EVENTS\".\"EventPEOEventNumber\" DESC)     AS \"rn\",\n        CAST(\"XLA_EVENTS\".\"EventPEOCreationDate\" AS TIMESTAMP)                                         AS \"LastValidationTime\",\n        \"XLA_EVENTS\".\"EventPEOEventId\"                                                                 AS \"EVENT_ID\",\n        \"XLA_EVENTS\".\"EventPEOEventPEOCreatedBy\"                                                       AS \"CREATED_BY\"\n    FROM \"FscmTopModelAM_FinExtractAM_XlaBiccExtractAM_SubledgerJournalTransactionEntityExtractPVO\" AS \"XLA_TRANSACTION_ENTITIES\"\n        LEFT JOIN \"FscmTopModelAM_FinExtractAM_XlaBiccExtractAM_SubledgerJournalEventExtractPVO\" AS \"XLA_EVENTS\"\n            ON \"XLA_TRANSACTION_ENTITIES\".\"TransactionApplicationId\" = \"XLA_EVENTS\".\"EventPEOApplicationId\"\n                AND \"XLA_TRANSACTION_ENTITIES\".\"TransactionEntityId\" = \"XLA_EVENTS\".\"EventPEOEntityId\"\n    WHERE \"XLA_TRANSACTION_ENTITIES\".\"TransactionEntityCode\" = 'AP_INVOICES'\n        AND \"XLA_TRANSACTION_ENTITIES\".\"TransactionApplicationId\" = 200\n        AND \"XLA_EVENTS\".\"EventPEOEventStatusCode\" = 'P'\n        AND \"XLA_EVENTS\".\"EventPEOEventTypeCode\" IN ('INVOICE VALIDATED', 'CREDIT MEMO VALIDATED', 'DEBIT MEMO VALIDATED')\n),  \n\"CTE_LastValidation\" AS (\n    SELECT \n        \"LastValTime\".\"INVOICE_ID\"         AS \"INVOICE_ID\",\n        \"LastValTime\".\"LastValidationTime\" AS \"LastValidationTime\",\n        \"LastValTime\".\"CREATED_BY\"         AS \"CREATED_BY\",\n        \"LastValTime\".\"EVENT_ID\"           AS \"EVENT_ID\"\n    FROM \"CTE_LastValidation_Time\" AS \"LastValTime\"\n    WHERE \"LastValTime\".\"rn\" = 1\n),\n\"CTE_FullValidation\" AS (\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsInvoiceId\" AS \"ApInvoiceDistributionsInvoiceId\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceDistributionExtractPVO\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n    WHERE \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsPostedFlag\" = 'Y'\n    EXCEPT\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsInvoiceId\" AS \"ApInvoiceDistributionsInvoiceId\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceDistributionExtractPVO\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n    WHERE \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsPostedFlag\" <> 'Y'\n),                       \n    \"CTE_AGG_INV_PMT\" AS (\n    SELECT \n        \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\"                         AS \"INVOICE_ID\", \n        \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllPaymentNum\"                        AS \"PAYMENT_NUM\" ,\n        COALESCE(SUM(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllDiscountTaken\"), 0)   AS \"DISCOUNT_TAKEN\",\n        COALESCE(SUM(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllDiscountLost\"), 0)    AS \"DISCOUNT_LOST\",\n        MAX(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllCreationDate\")                 AS \"LAST_PAYMENT_DATE\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_PaidDisbursementScheduleExtractPVO\" AS \"AP_INVOICE_PAYMENTS_ALL\"\n    WHERE (NULLIF(\"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalFlag\", '') IS NULL\n            OR \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllReversalFlag\" = 'N')        \n    GROUP BY \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllInvoiceId\", \"AP_INVOICE_PAYMENTS_ALL\".\"ApInvoicePaymentsAllPaymentNum\"\n),\n\t\"CTE_PORELATED\" AS (\n    SELECT \n        \"AP_INVOICE_LINES_ALL\".\"ApInvoiceLinesAllInvoiceId\"                      AS \"INVOICE_ID\",\n        CASE\n            WHEN COUNT(\"AP_INVOICE_LINES_ALL\".\"ApInvoiceLinesAllPoHeaderId\") > 0 \n                THEN 'Y'\n            ELSE 'N'\n        END                                                                      AS \"PO_RELATED_FLAG\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceLineExtractPVO\" AS \"AP_INVOICE_LINES_ALL\"\n    GROUP BY \"AP_INVOICE_LINES_ALL\".\"ApInvoiceLinesAllInvoiceId\"   \n),\n    \"CTE_PERIOD_LOOKUP\" AS (\n    SELECT \n        \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsInvoiceId\"            AS \"INVOICE_ID\",\n        MIN(CAST(\"GL_PERIOD_STATUSES\".\"GlPeriodStatusesPeriodYear\" AS INTEGER))     AS \"PERIOD_YEAR\"\n    FROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceDistributionExtractPVO\" AS \"AP_INVOICE_DISTRIBUTIONS_ALL\"\n        LEFT JOIN \"FscmTopModelAM_FinExtractAM_GlBiccExtractAM_PeriodStatusExtractPVO\" AS \"GL_PERIOD_STATUSES\"\n            ON \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsPeriodName\" = \"GL_PERIOD_STATUSES\".\"GlPeriodStatusesPeriodName\"\n                AND \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsSetOfBooksId\" = \"GL_PERIOD_STATUSES\".\"GlPeriodStatusesSetOfBooksId\"\n    GROUP BY \"AP_INVOICE_DISTRIBUTIONS_ALL\".\"ApInvoiceDistributionsInvoiceId\"\n)\nSELECT \n    <%=sourceSystem%>  || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" \n        || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\"                                     AS \"ID\",\n    <%=sourceSystem%>  || '::' || \"LastValidation\".\"CREATED_BY\"                                                     AS \"CreatedBy\",\n    <%=sourceSystem%>  || '::' || \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\"                       AS \"VendorInvoice\",\n    <%=sourceSystem%>  || '::' || \"AP_INVOICES_ALL\".\"ApInvoicesVendorId\"                                            AS \"Vendor\",\n    \"LastValidation\".\"LastValidationTime\"                                                                           AS \"CreationTime\",\n    CAST(\"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" AS VARCHAR(255))                              AS \"ItemNumber\",\n    \"PERIOD_LOOKUP\".\"PERIOD_YEAR\"                                                                                   AS \"FiscalYear\",\n    CASE\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesSource\" = 'Manual Invoice Entry'\n            THEN 'Manual'\n        ELSE 'Automatic'\n    END                                                                                                             AS \"CreationExecutionType\",\n    \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceCurrencyCode\"                                                               AS \"Currency\",\n    \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllDiscountAmountAvailable\"                                       AS \"CashDiscountEligibleAmount1\",\n    \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllSecondDiscAmtAvailable\"                                        AS \"CashDiscountEligibleAmount2\",\n    \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvCurrGrossAmount\"                                            AS \"Amount\",\n    \"TERMS\".\"PaymentTermHeaderTranslationName\"                                                                      AS \"PaymentTerms\", \n    \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentMethodCode\"                                             AS \"PaymentMethodCode\",  \n    CASE\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesPaymentStatusFlag\" = 'Y'\n            THEN \"AGG_INV_PMT\".\"LAST_PAYMENT_DATE\" \n    END                                                                                                             AS \"ClearingDate\",\n    CAST(\"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllDiscountDate\" AS TIMESTAMP)                               AS \"CashDiscountDueDate1\",\n    CAST(\"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllSecondDiscountDate\" AS TIMESTAMP)                         AS \"CashDiscountDueDate2\",\n    CAST(\"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllDueDate\" AS TIMESTAMP)                                    AS \"NetDueDate\",\n    CAST(\"AP_INVOICES_ALL\".\"ApInvoicesTermsDate\" AS TIMESTAMP)                                                      AS \"BaselineDate\",\n    CAST(\"AP_INVOICES_ALL\".\"ApInvoicesInvoiceDate\" AS TIMESTAMP)                                                    AS \"DocumentDate\",\n    \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceNum\"                                                                        AS \"Reference\",\n    CASE \n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" = 'STANDARD' \n            THEN 'InvoiceItem'\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" = 'CREDIT' \n            THEN 'CreditMemoItem'\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" = 'DEBIT' \n            THEN 'DebitMemoItem'\n        ELSE 'Other'\n    END                                                                                                             AS \"DocumentCategory\",     \n    CASE \n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" = 'STANDARD' \n            THEN 'Credit'\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" = 'CREDIT' \n            THEN 'Debit'\n        ELSE 'Other'\n    END                                                                                                             AS \"DebitCreditIndicator\", \n    CASE \n        WHEN \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllHoldFlag\" = 'N' \n        THEN FALSE\n        WHEN \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllHoldFlag\" = 'Y'  \n        THEN TRUE\n    END                                                                                                             AS \"IsBlockedForPayment\",\n    CASE\n        WHEN \"AP_INVOICES_ALL\".\"ApInvoicesCancelledDate\" IS NOT NULL \n            THEN TRUE \n        ELSE FALSE\n    END                                                                                                             AS \"IsReversed\",\n    CASE\n        WHEN \"PO_RELATED\".\"PO_RELATED_FLAG\" = 'Y' \n            THEN TRUE \n        ELSE FALSE\n    END                                                                                                             AS \"IsPurchaseDocumentRelated\",\n    COALESCE(\"AGG_INV_PMT\".\"DISCOUNT_TAKEN\", 0)                                                                     AS \"CashDiscountTakenAmount\",\n    CAST(\"AP_INVOICES_ALL\".\"ApInvoicesInvoiceReceivedDate\" AS TIMESTAMP)                                            AS \"ReceiptDate\",\n    \"HR_ALL_ORGANIZATION_UNITS\".\"FunBuPerfPEOName\"                                                                  AS \"BusinessUnit\",\n    <%=sourceSystem%>                                                                                               AS \"SourceSystemInstance\"\nFROM \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoicePaymentScheduleExtractPVO\" AS \"AP_PAYMENT_SCHEDULES_ALL\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_InvoiceHeaderExtractPVO\" AS \"AP_INVOICES_ALL\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" = \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_FunBiccExtractAM_BusinessUnitExtractPVO\" AS \"HR_ALL_ORGANIZATION_UNITS\"\n        ON \"AP_INVOICES_ALL\".\"ApInvoicesOrgId\" = \"HR_ALL_ORGANIZATION_UNITS\".\"FunBuPerfPEOBusinessUnitId\"  \n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_ApBiccExtractAM_PaymentTermHeaderTranslationExtractPVO\" AS \"TERMS\"\n        ON \"AP_INVOICES_ALL\".\"ApInvoicesTermsId\" = \"TERMS\".\"PaymentTermHeaderTranslationTermId\"\n            AND \"TERMS\".\"PaymentTermHeaderTranslationLanguage\" = <%=languageKey%>       \n    LEFT JOIN \"CTE_PERIOD_LOOKUP\" AS \"PERIOD_LOOKUP\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" = \"PERIOD_LOOKUP\".\"INVOICE_ID\"\n    LEFT JOIN \"CTE_LastValidation\" AS \"LastValidation\"\n        ON \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\" = \"LastValidation\".\"INVOICE_ID\"\n    LEFT JOIN \"CTE_AGG_INV_PMT\" AS \"AGG_INV_PMT\"\n        ON \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllInvoiceId\" = \"AGG_INV_PMT\".\"INVOICE_ID\"\n            AND \"AP_PAYMENT_SCHEDULES_ALL\".\"ApPaymentSchedulesAllPaymentNum\" = \"AGG_INV_PMT\".\"PAYMENT_NUM\"\n    LEFT JOIN \"CTE_FullValidation\" AS \"FullValidation\"\n        ON \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\" = \"FullValidation\".\"ApInvoiceDistributionsInvoiceId\"    \n    LEFT JOIN \"CTE_PORELATED\" AS \"PO_RELATED\"\n        ON \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceId\" = \"PO_RELATED\".\"INVOICE_ID\"\nWHERE \"AP_INVOICES_ALL\".\"ApInvoicesInvoiceTypeLookupCode\" IN ('STANDARD','CREDIT','DEBIT')\n    AND \"LastValidation\".\"INVOICE_ID\" IS NOT NULL\n    AND \"FullValidation\".\"ApInvoiceDistributionsInvoiceId\" IS NOT NULL    \n"
                    }
                ],
                "relationship_transformations": []
            }
        ]
    }
]