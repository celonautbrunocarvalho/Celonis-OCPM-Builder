[
    {
        "change_date": 1757601696315.0,
        "changed_by": {
            "id": "4d82ae0d-2047-4c83-ac8c-e2da04a3b5a0",
            "name": "Brave Gujral",
            "type_": "USER"
        },
        "created_by": {
            "id": "2202cbc9-7251-4630-bfb2-36812e688613",
            "name": "l.pigozzi",
            "type_": "USER"
        },
        "creation_date": 1749630815643.0,
        "data_connection_id": "42d53587-d7fa-45cf-8403-26770d8029d0",
        "description": "",
        "disabled": null,
        "display_name": "CustomerBlock transformation - 00. Central Extraction Pool_Oracle-ebs - 1",
        "draft": null,
        "factory_id": "96c7734c-a450-443a-9b2e-704f26b5d90c",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "LanguageKey",
                "value": "'US'"
            },
            {
                "name": "sourceSystem",
                "value": "'Oracle_EBS'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "CustomerBlock",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [],
                "foreign_key_names": [
                    "BlockedBy",
                    "Customer",
                    "ReleasedBy"
                ],
                "namespace": "custom",
                "property_names": [
                    "BlockExecutionType",
                    "BlockType",
                    "CreationTime",
                    "FirstBlockReason",
                    "ID",
                    "LatestBlockReason",
                    "LatestBlockReasonText",
                    "ReleaseExecutionType",
                    "ReleaseReason",
                    "ReleaseTime",
                    "ReleaseType",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "CustomerBlockAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_CustomerBlock\" AS\n(\n--Credit Block\nSELECT <%=sourceSystem%>  \n       || '::' || CAST(\"OE_ORDER_HOLDS_ALL\".\"ORDER_HOLD_ID\"  AS VARCHAR(255))          AS \"ID\",\n       \"OE_ORDER_HOLDS_ALL\".\"CREATION_DATE\"                                            AS \"CreationTime\",\n       'CreditBlock'                                                                   AS \"BlockType\",\n       \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\"                                               AS \"FirstBlockReason\",\n       CASE\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'N'\n               THEN \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\"\n            END                                                                         AS \"LatestBlockReason\",\n       CASE\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'N'\n               THEN \"FND_LOOKUP_VALUES\".\"MEANING\" \n               END                                                                     AS \"LatestBlockReasonText\",\n       <%=sourceSystem%> || '::' || \"OE_ORDER_HOLDS_ALL\".\"CREATED_BY\"                  AS \"BlockedBy\",\n       'Automatic'                                                                     AS \"BlockExecutionType\",\n       \"OE_HOLD_RELEASES\".\"CREATION_DATE\"                                              AS \"ReleaseTime\",\n       CASE\n           WHEN \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" IS NOT NULL\n               THEN 'CreditBlock' \n               END                                                                     AS \"ReleaseType\",\n       \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\"                 AS \"ReleaseReason\",\n       <%=sourceSystem%> || '::' || \"OE_HOLD_RELEASES\".\"CREATED_BY\"                    AS \"ReleasedBy\",\n       CASE\n           WHEN \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" LIKE '%AUTOMATIC%'\n               OR \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" = 'OM_CLOSE'\n               OR \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" = 'OM_CANCEL'\n               THEN 'Automatic'\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'Y'\n                       THEN 'Manual'\n           END                                                                        AS \"ReleaseExecutionType\",\n     <%=sourceSystem%> || '::' || \"OE_HOLD_SOURCES_ALL\".\"HOLD_ENTITY_ID\"              AS \"Customer\",\n     <%=sourceSystem%>                                                                AS \"SourceSystemInstance\"\nFROM \"OE_ORDER_HOLDS_ALL\" AS \"OE_ORDER_HOLDS_ALL\"\n         LEFT JOIN \"OE_HOLD_SOURCES_ALL\" AS \"OE_HOLD_SOURCES_ALL\"\n                   ON \"OE_ORDER_HOLDS_ALL\".\"HOLD_SOURCE_ID\" = \"OE_HOLD_SOURCES_ALL\".\"HOLD_SOURCE_ID\"\n                       AND \"OE_ORDER_HOLDS_ALL\".\"ORG_ID\" = \"OE_HOLD_SOURCES_ALL\".\"ORG_ID\"\n         LEFT JOIN \"OE_HOLD_DEFINITIONS\" AS \"OE_HOLD_DEFINITIONS\"\n                   ON \"OE_HOLD_SOURCES_ALL\".\"HOLD_ID\" = \"OE_HOLD_DEFINITIONS\".\"HOLD_ID\"\n         LEFT JOIN \"OE_HOLD_RELEASES\" AS \"OE_HOLD_RELEASES\"\n                   ON \"OE_ORDER_HOLDS_ALL\".\"HOLD_RELEASE_ID\" = \"OE_HOLD_RELEASES\".\"HOLD_RELEASE_ID\"\n         LEFT JOIN \"FND_LOOKUP_VALUES\" AS \"FND_LOOKUP_VALUES\"\n                   ON \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" = \"FND_LOOKUP_VALUES\".\"LOOKUP_CODE\"\n                       AND \"FND_LOOKUP_VALUES\".\"ZD_EDITION_NAME\" = 'SET1' \n                       AND \"FND_LOOKUP_VALUES\".\"LOOKUP_TYPE\" = 'HOLD_TYPE'\n                       AND \"FND_LOOKUP_VALUES\".\"VIEW_APPLICATION_ID\" = '660'\n                       AND \"FND_LOOKUP_VALUES\".\"LANGUAGE\" = <%=LanguageKey%>  \nWHERE \"OE_HOLD_SOURCES_ALL\".\"HOLD_ENTITY_CODE\" = 'C'\n  AND \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" = 'CREDIT'\nUNION\n--Billing and Delivery Block\nSELECT <%=sourceSystem%>  \n       || '::' || CAST(\"OE_ORDER_HOLDS_ALL\".\"ORDER_HOLD_ID\"  AS VARCHAR(255))          AS \"ID\",\n       \"OE_ORDER_HOLDS_ALL\".\"CREATION_DATE\"                                            AS \"CreationTime\",\n       CASE\n           WHEN \"OE_HOLD_DEFINITIONS\".\"ACTIVITY_NAME\"\n               IN ('HEADER_INVOICE_INTERFACE', 'INVOICE_INTERFACE')\n               THEN 'BillingBlock'\n           ELSE 'DeliveryBlock'\n           END                                                                          AS \"BlockType\",\n       \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\"                                                AS \"FirstBlockReason\",\n       CASE\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'N'\n               THEN \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" \n            END                                                                         AS \"LatestBlockReason\",\n       CASE\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'N'\n               THEN \"FND_LOOKUP_VALUES\".\"MEANING\" \n            END                                                                         AS \"LatestBlockReasonText\",\n       <%=sourceSystem%> || '::' || \"OE_ORDER_HOLDS_ALL\".\"CREATED_BY\"                   AS \"BlockedBy\", \n       CASE\n           WHEN \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" = 'HOLD' THEN 'Manual'\n           ELSE 'Automatic'\n           END                                                                          AS \"BlockExecutionType\",\n       \"OE_HOLD_RELEASES\".\"CREATION_DATE\"                                               AS \"ReleaseTime\",\n       CASE\n           WHEN \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" IS NOT NULL\n               THEN CASE\n                        WHEN \"OE_HOLD_DEFINITIONS\".\"ACTIVITY_NAME\"\n                            IN ('HEADER_INVOICE_INTERFACE', 'INVOICE_INTERFACE')\n                            THEN 'BillingBlock'\n                        ELSE 'DeliveryBlock' \n                    END\n           END                                                                         AS \"ReleaseType\",\n       \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\"                 AS \"ReleaseReason\",\n       <%=sourceSystem%> || '::' || \"OE_HOLD_RELEASES\".\"CREATED_BY\"                    AS \"ReleasedBy\",\n       CASE\n           WHEN \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" LIKE '%AUTOMATIC%'\n               OR \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" = 'OM_CLOSE'\n               OR \"OE_HOLD_RELEASES\".\"RELEASE_REASON_CODE\" = 'OM_CANCEL'\n               THEN 'Automatic'\n           WHEN \"OE_ORDER_HOLDS_ALL\".\"RELEASED_FLAG\" = 'Y'\n                       THEN 'Manual'\n           END                                                                         AS \"ReleaseExecutionType\",\n       <%=sourceSystem%> || '::' || \"OE_HOLD_SOURCES_ALL\".\"HOLD_ENTITY_ID\"             AS \"Customer\", \n       <%=sourceSystem%>                                                               AS \"SourceSystemInstance\"\nFROM \"OE_ORDER_HOLDS_ALL\" AS \"OE_ORDER_HOLDS_ALL\"\n         LEFT JOIN \"OE_HOLD_SOURCES_ALL\" AS \"OE_HOLD_SOURCES_ALL\"\n                   ON \"OE_ORDER_HOLDS_ALL\".\"HOLD_SOURCE_ID\" = \"OE_HOLD_SOURCES_ALL\".\"HOLD_SOURCE_ID\"\n                       AND \"OE_ORDER_HOLDS_ALL\".\"ORG_ID\" = \"OE_HOLD_SOURCES_ALL\".\"ORG_ID\"\n         LEFT JOIN \"OE_HOLD_DEFINITIONS\" AS \"OE_HOLD_DEFINITIONS\"\n                   ON \"OE_HOLD_SOURCES_ALL\".\"HOLD_ID\" = \"OE_HOLD_DEFINITIONS\".\"HOLD_ID\"\n         LEFT JOIN \"OE_HOLD_RELEASES\" AS \"OE_HOLD_RELEASES\"\n                   ON \"OE_ORDER_HOLDS_ALL\".\"HOLD_RELEASE_ID\" = \"OE_HOLD_RELEASES\".\"HOLD_RELEASE_ID\"\n         LEFT JOIN \"FND_LOOKUP_VALUES\" AS \"FND_LOOKUP_VALUES\"\n                   ON \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" = \"FND_LOOKUP_VALUES\".\"LOOKUP_CODE\"\n                       AND \"FND_LOOKUP_VALUES\".\"ZD_EDITION_NAME\" = 'SET1' \n                       AND \"FND_LOOKUP_VALUES\".\"LOOKUP_TYPE\" = 'HOLD_TYPE'\n                       AND \"FND_LOOKUP_VALUES\".\"VIEW_APPLICATION_ID\" = '660'\n                       AND \"FND_LOOKUP_VALUES\".\"LANGUAGE\" = <%=LanguageKey%>  \nWHERE \"OE_HOLD_DEFINITIONS\".\"TYPE_CODE\" != 'CREDIT'\n  AND \"OE_HOLD_SOURCES_ALL\".\"HOLD_ENTITY_CODE\" = 'C'\n  AND \"OE_HOLD_DEFINITIONS\".\"ACTIVITY_NAME\" IN ('HEADER_INVOICE_INTERFACE', 'INVOICE_INTERFACE', 'LINE_SCHEDULING')\n  )\n  SELECT \"ID\"                    AS \"ID\",\n         \"CreationTime\"          AS \"CreationTime\",\n         \"BlockType\"             AS \"BlockType\",\n         \"FirstBlockReason\"      AS \"FirstBlockReason\",\n         \"LatestBlockReason\"     AS \"LatestBlockReason\",\n         \"LatestBlockReasonText\" AS \"LatestBlockReasonText\",\n         \"BlockedBy\"             AS \"BlockedBy\", \n         \"BlockExecutionType\"    AS \"BlockExecutionType\",\n         \"ReleaseTime\"           AS \"ReleaseTime\",\n         \"ReleaseType\"           AS \"ReleaseType\",\n         \"ReleaseReason\"         AS \"ReleaseReason\",\n         \"ReleasedBy\"            AS \"ReleasedBy\",\n         \"ReleaseExecutionType\"  AS \"ReleaseExecutionType\",\n         \"Customer\"              AS \"Customer\", \n        \"SourceSystemInstance\"   AS \"SourceSystemInstance\"\nFROM  \"CTE_CustomerBlock\"\n"
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1758650265193.0,
        "changed_by": {
            "id": "9009518c-e25c-4997-b8d1-49ec38885680",
            "name": "Pooja Singh Dohare",
            "type_": "USER"
        },
        "created_by": {
            "id": "4d82ae0d-2047-4c83-ac8c-e2da04a3b5a0",
            "name": "Brave Gujral",
            "type_": "USER"
        },
        "creation_date": 1751891949381.0,
        "data_connection_id": "03736e95-3931-4eda-8dfe-fc16e11388bc",
        "description": null,
        "disabled": null,
        "display_name": "CustomerBlock - OracleFusion",
        "draft": null,
        "factory_id": "30d1a8c8-1f7b-4dac-9f4b-bd6369554a8f",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "LanguageKey",
                "value": "'US'"
            },
            {
                "name": "sourceSystem",
                "value": "'Oracle_Fusion'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "CustomerBlock",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [],
                "foreign_key_names": [
                    "BlockedBy",
                    "Customer",
                    "ReleasedBy"
                ],
                "namespace": "custom",
                "property_names": [
                    "BlockExecutionType",
                    "BlockType",
                    "CreationTime",
                    "FirstBlockReason",
                    "ID",
                    "LatestBlockReason",
                    "LatestBlockReasonText",
                    "ReleaseExecutionType",
                    "ReleaseReason",
                    "ReleaseTime",
                    "ReleaseType",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "CustomerBlockAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_CustomerBlock\" AS (\n    SELECT <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldInstanceId\" AS \"ID\",\n        \"DOO_HOLD_INSTANCES\".\"HoldInstanceCreationDate\"                                    AS \"CreationTime\",\n        'CreditBlock'                                                                      AS \"BlockType\",\n        \"DOO_HOLD_CODES_B\".\"HoldHoldCode\"                                                  AS \"FirstBlockReason\",\n        CASE\n            WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'Y'\n                THEN \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" \n        END                                                                                AS \"LatestBlockReason\",\n        CASE\n            WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'Y'\n                THEN \"DOO_HOLD_CODES_B\".\"HoldTranslationHoldDescription\"  \n        END                                                                                AS \"LatestBlockReasonText\",\n        <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceCreatedBy\"         AS \"BlockedBy\",\n        'Automatic'                                                                        AS \"BlockExecutionType\",\n        \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseDate\"                                     AS \"ReleaseTime\",\n        'CreditBlock'                                                                      AS \"ReleaseType\",\n        \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\"                           AS \"ReleaseReason\",\n        <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\"     AS \"ReleasedBy\",\n        CASE\n            WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\" IS NOT NULL\n                THEN 'Manual'\n            WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\" IS NULL\n                    AND \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'N'\n                THEN 'Automatic'\n        END                                                                                AS \"ReleaseExecutionType\",\n        <%=sourceSystem%> || '::' || \"DOO_FULFILL_LINES_ALL\".\"FulfillLineBillToCustomerId\" AS \"Customer\",\n        <%=sourceSystem%>                                                                  AS \"SourceSystemInstance\"\n    FROM \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_HoldInstanceExtractPVO\" AS \"DOO_HOLD_INSTANCES\"\n        LEFT JOIN \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_HoldCodeExtractPVO\" AS \"DOO_HOLD_CODES_B\"\n            ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldCodeId\" = \"DOO_HOLD_CODES_B\".\"HoldHoldCodeId\"\n                AND \"DOO_HOLD_CODES_B\".\"HoldTranslationLanguage\" = <%=LanguageKey%>\n        LEFT JOIN \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_FulfillLineExtractPVO\" AS \"DOO_FULFILL_LINES_ALL\"\n            ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityId1\" = \"DOO_FULFILL_LINES_ALL\".\"FulfillLineId\"\n        LEFT JOIN \"FscmTopModelAM_FinExtractAM_AnalyticsExtractServiceAM_LookupValuesTLExtractPVO\" AS \"FND_LOOKUP_VALUES\"\n            ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\" = \"FND_LOOKUP_VALUES\".\"LookupCode\"\n                AND \"FND_LOOKUP_VALUES\".\"LookupType\" = 'DOO_HLD_RELEASE_REASON'\n                AND \"FND_LOOKUP_VALUES\".\"ViewApplicationId\" = '0'\n                AND \"FND_LOOKUP_VALUES\".\"Language\" = <%=LanguageKey%> \n    WHERE \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityId1\" IS NOT NULL\n        AND \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityName1\" = 'DOO_ORDER_FLINES_V'\n        AND \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" IN ('DOO_CREDIT_CHECK', 'HOLD_FOR_CREDIT_CHECK'\n)\nUNION\nSELECT \n    <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldInstanceId\"      AS \"ID\",\n    \"DOO_HOLD_INSTANCES\".\"HoldInstanceCreationDate\"                                      AS \"CreationTime\",\n    CASE\n        WHEN \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" IN ('HOLD_FOR_SCHEDULING', 'HOLD_FOR_SHIPPING_INSTRUCTIONS')\n            THEN 'DeliveryBlock'\n        WHEN \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" = 'DOO_INVOICE_CREATE'\n            THEN 'BillingBlock'\n    END                                                                                  AS \"BlockType\",\n   \"DOO_HOLD_CODES_B\".\"HoldHoldCode\"                                                     AS \"FirstBlockReason\",\n    CASE\n        WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'Y'\n            THEN \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" \n    END                                                                                  AS \"LatestBlockReason\",\n    CASE\n        WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'Y'\n            THEN \"DOO_HOLD_CODES_B\".\"HoldTranslationHoldDescription\"\n    END                                                                                  AS \"LatestBlockReasonText\",\n    <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceCreatedBy\"           AS \"BlockedBy\",\n    'Automatic'                                                                          AS \"BlockExecutionType\",\n    \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseDate\"                                       AS \"ReleaseTime\",\n    CASE\n        WHEN (\"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\" LIKE '%SCHEDULING%' \n                OR \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\" LIKE '%SHIPPING%')\n            THEN 'DeliveryBlock'\n        WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\" LIKE '%INVOICE%'\n            THEN 'BillingBlock'\n    END                                                                                  AS \"ReleaseType\",\n    \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\"                             AS \"ReleaseReason\",\n    <%=sourceSystem%> || '::' ||  \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\"       AS \"ReleasedBy\",\n    CASE\n        WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\" IS NOT NULL\n            THEN 'Manual'\n        WHEN \"DOO_HOLD_INSTANCES\".\"HoldInstanceReleaseUserId\" IS NULL\n            AND \"DOO_HOLD_INSTANCES\".\"HoldInstanceActiveFlag\" = 'N'\n            THEN 'Automatic'\n    END                                                                                  AS \"ReleaseExecutionType\",\n    <%=sourceSystem%> || '::' ||  \"DOO_FULFILL_LINES_ALL\".\"FulfillLineBillToCustomerId\"  AS \"Customer\",\n    <%=sourceSystem%>                                                                    AS \"SourceSystemInstance\"\nFROM \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_HoldInstanceExtractPVO\" AS \"DOO_HOLD_INSTANCES\"\n    LEFT JOIN \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_HoldCodeExtractPVO\" AS \"DOO_HOLD_CODES_B\"\n        ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldCodeId\" = \"DOO_HOLD_CODES_B\".\"HoldHoldCodeId\"\n            AND \"DOO_HOLD_CODES_B\".\"HoldTranslationLanguage\" = <%=LanguageKey%>\n    LEFT JOIN \"FscmTopModelAM_ScmExtractAM_DooBiccExtractAM_FulfillLineExtractPVO\" AS \"DOO_FULFILL_LINES_ALL\"\n        ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityId1\" = \"DOO_FULFILL_LINES_ALL\".\"FulfillLineId\"\n    LEFT JOIN \"FscmTopModelAM_FinExtractAM_AnalyticsExtractServiceAM_LookupValuesTLExtractPVO\" AS \"FND_LOOKUP_VALUES\"\n        ON \"DOO_HOLD_INSTANCES\".\"HoldInstanceHoldReleaseReasonCode\" = \"FND_LOOKUP_VALUES\".\"LookupCode\"\n            AND \"FND_LOOKUP_VALUES\".\"LookupType\" = 'DOO_HLD_RELEASE_REASON'\n            AND \"FND_LOOKUP_VALUES\".\"ViewApplicationId\" = '0'\n            AND \"FND_LOOKUP_VALUES\".\"Language\" =<%=LanguageKey%>\nWHERE \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityId1\" IS NOT NULL\n    AND \"DOO_HOLD_INSTANCES\".\"HoldInstanceTransactionEntityName1\" = 'DOO_ORDER_FLINES_V'\n    AND \"DOO_HOLD_CODES_B\".\"HoldHoldCode\" IN ('HOLD_FOR_SCHEDULING', 'DOO_INVOICE_CREATE','HOLD_FOR_SHIPPING_INSTRUCTIONS')\n)\nSELECT \n    \"ID\"                    AS \"ID\",\n    \"CreationTime\"          AS \"CreationTime\",\n    \"BlockType\"             AS \"BlockType\",\n    \"FirstBlockReason\"      AS \"FirstBlockReason\",\n    \"LatestBlockReason\"     AS \"LatestBlockReason\",\n    \"LatestBlockReasonText\" AS \"LatestBlockReasonText\",\n    \"BlockedBy\"             AS \"BlockedBy\", \n    \"BlockExecutionType\"    AS \"BlockExecutionType\",\n    \"ReleaseTime\"           AS \"ReleaseTime\",\n    \"ReleaseType\"           AS \"ReleaseType\",\n    \"ReleaseReason\"         AS \"ReleaseReason\",\n    \"ReleasedBy\"            AS \"ReleasedBy\",\n    \"ReleaseExecutionType\"  AS \"ReleaseExecutionType\",\n    \"Customer\"              AS \"Customer\",\n    \"SourceSystemInstance\"  AS \"SourceSystemInstance\"\nFROM \"CTE_CustomerBlock\"\n"
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1761753691077.0,
        "changed_by": {
            "id": "2202cbc9-7251-4630-bfb2-36812e688613",
            "name": "l.pigozzi",
            "type_": "USER"
        },
        "created_by": {
            "id": "d94aa797-47b6-48e1-9b0f-9627812b5866",
            "name": "Lea Hanna",
            "type_": "USER"
        },
        "creation_date": 1753306002635.0,
        "data_connection_id": "8939ad05-4472-435c-a065-ed31be1b9fea",
        "description": null,
        "disabled": null,
        "display_name": "CustomerBlock - S4 Hana",
        "draft": null,
        "factory_id": "81d63286-0c83-48ea-b2d2-7ad7f5641acf",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "LanguageKey",
                "value": "'E'"
            },
            {
                "name": "sourceSystem",
                "value": "'SAP_S4_HANA'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "CustomerBlock",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [],
                "foreign_key_names": [
                    "BlockedBy",
                    "Customer",
                    "ReleasedBy"
                ],
                "namespace": "custom",
                "property_names": [
                    "BlockExecutionType",
                    "BlockType",
                    "CreationTime",
                    "FirstBlockReason",
                    "ID",
                    "LatestBlockReason",
                    "LatestBlockReasonText",
                    "ReleaseExecutionType",
                    "ReleaseReason",
                    "ReleaseTime",
                    "ReleaseType",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "CustomerBlockAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_JoinTable\" AS (\n    SELECT\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 1, 3)\n            || '::' || SUBSTRING(\"CDPOS\".\"TABKEY\", 4, 10)             AS \"JoinID\",\n        CAST(\"CDHDR\".\"UDATE\" AS DATE)\n            + COALESCE(CAST(\"CDHDR\".\"UTIME\" AS TIME), TIME '23:59:59') AS \"JoinTime\",\n        \"CDHDR\".\"UDATE\"                                                AS \"UDATE\",\n        \"CDHDR\".\"UTIME\"                                                AS \"UTIME\",\n        \"CDPOS\".\"FNAME\"                                                AS \"FNAME\",\n        \"CDPOS\".\"TABNAME\"                                              AS \"TABNAME\",\n        \"CDPOS\".\"VALUE_NEW\"                                            AS \"VALUE_NEW\",\n        \"CDPOS\".\"VALUE_OLD\"                                            AS \"VALUE_OLD\",\n        \"CDHDR\".\"MANDANT\" || '::' || \"CDHDR\".\"USERNAME\"                AS \"JoinUserID\",\n        CASE\n            WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                THEN 'Automatic'\n            ELSE 'Manual'\n        END                                                            AS \"JoinExecutionType\",\n        \"CDHDR\".\"TCODE\"                                                AS \"JoinOperationType\",\n        \"CDHDR\".\"CHANGENR\"                                             AS \"JoinSystemNumber\",\n        \"CDPOS\".\"OBJECTCLAS\"                                           AS \"OBJECTCLAS\"\n    FROM \"CDPOS\" AS \"CDPOS\"\n    INNER JOIN \"CDHDR\" AS \"CDHDR\"\n        ON \"CDPOS\".\"MANDANT\" = \"CDHDR\".\"MANDANT\"\n            AND \"CDPOS\".\"OBJECTCLAS\" = \"CDHDR\".\"OBJECTCLAS\"\n            AND \"CDPOS\".\"OBJECTID\" = \"CDHDR\".\"OBJECTID\"\n            AND \"CDPOS\".\"CHANGENR\" = \"CDHDR\".\"CHANGENR\"\n            AND \"CDPOS\".\"CHNGIND\" = 'U'\n            AND \"CDPOS\".\"TABNAME\" = 'KNA1'\n            AND \"CDPOS\".\"FNAME\" IN ('FAKSD', 'LIFSD')\n    LEFT JOIN \"USR02\" AS \"USR02\"\n        ON \"CDHDR\".\"MANDANT\" = \"USR02\".\"MANDT\"\n            AND \"CDHDR\".\"USERNAME\" = \"USR02\".\"BNAME\"\n    ),\n    \"CTE_Releases\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                                                                                                    AS \"ReleasesID\",\n            \"JoinTable\".\"JoinTime\"                                                                                                  AS \"ReleaseTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                                                                                                     AS \"ReleaseType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\"                                                                                  AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                                                                                                 AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                                                                                                 AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"                                                                                                AS \"ReleasedBy_ID\",\n            \"JoinTable\".\"JoinExecutionType\"                                                                                         AS \"ReleaseExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"                                                                                         AS \"ReleaseOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"                                                                                          AS \"SystemReleaseNumber\",\n            \"JoinTable\".\"JoinID\"                                                                                                    AS \"CustomerID\",\n            ROW_NUMBER()\n            OVER (PARTITION BY \"JoinTable\".\"JoinID\", \"JoinTable\".\"FNAME\" ORDER BY \"JoinTable\".\"UDATE\" ASC, \"JoinTable\".\"UTIME\" ASC) AS \"ReleaseRN\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NOT NULL\n            AND \"JoinTable\".\"VALUE_NEW\" IS NULL\n    ),\n    \"CTE_Changes\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                       AS \"ID\",\n            \"JoinTable\".\"JoinTime\"                 AS \"ChangeTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                    AS \"ChangeType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\" AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"               AS \"ChangeBy\",\n            \"JoinTable\".\"JoinExecutionType\"        AS \"ChangeExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"        AS \"ChangeOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"         AS \"ChangeID\",\n            \"JoinTable\".\"JoinID\"                   AS \"CustomerID\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NOT NULL\n            AND \"JoinTable\".\"VALUE_NEW\" IS NOT NULL\n    ),\n    \"CTE_BlockFromChangelog\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                   AS \"BlockID\",\n            \"JoinTable\".\"JoinTime\"                 AS \"BlockTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                    AS \"BlockType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\" AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"               AS \"BlockedBy\",\n            \"JoinTable\".\"JoinExecutionType\"        AS \"BlockExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"        AS \"BlockOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"         AS \"SystemBlockNumber\",\n            \"JoinTable\".\"JoinID\"                   AS \"CustomerID\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NULL\n             AND \"JoinTable\".\"VALUE_NEW\" IS NOT NULL\n    ),\n    \"CTE_ImplicitActiveBlock\" AS (\n        SELECT\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\" AS \"BlockID\",\n            CAST(\"KNA1\".\"ERDAT\" AS DATE)             AS \"BlockTime\",\n            'BillingBlock'                           AS \"BlockType\",\n            'Block to ' || \"KNA1\".\"FAKSD\"            AS \"ValueType\",\n            \"KNA1\".\"FAKSD\"                           AS \"VALUE_NEW\",\n            NULL                                     AS \"VALUE_OLD\",\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\" AS \"BlockedBy\",\n            CASE\n                WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                    THEN 'Automatic'\n                ELSE 'Manual'\n            END                                      AS \"BlockExecutionType\",\n            NULL                                     AS \"BlockOperationType\",\n            '-1'                                     AS \"SystemBlockNumber\",\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\" AS \"CustomerID\"\n        FROM \"KNA1\" AS \"KNA1\"\n        LEFT JOIN \"CTE_BlockFromChangelog\" AS \"Block\"\n            ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Block\".\"BlockType\" = 'BillingBlock'\n        LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n            ON \"Releases\".\"ReleasesID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Releases\".\"ReleaseType\" = 'BillingBlock'\n        LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n            ON \"Changes\".\"ID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Changes\".\"ChangeType\" = 'BillingBlock'\n        LEFT JOIN \"USR02\" AS \"USR02\"\n            ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n    WHERE \"Block\".\"BlockID\" IS NULL\n        AND \"Changes\".\"ID\" IS NULL\n        AND \"Releases\".\"ReleasesID\" IS NULL\n        AND \"KNA1\".\"FAKSD\" IS NOT NULL\n    UNION\n    SELECT\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"    AS \"BlockID\",\n        CAST(\"KNA1\".\"ERDAT\" AS DATE)                AS \"BlockTime\",\n        'DeliveryBlock'                             AS \"BlockType\",\n        'Block to ' || \"KNA1\".\"LIFSD\"               AS \"ValueType\",\n        \"KNA1\".\"LIFSD\"                              AS \"VALUE_NEW\",\n        NULL                                        AS \"VALUE_OLD\",\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\"    AS \"BlockedBy\",\n        CASE\n            WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                THEN 'Automatic'\n            ELSE 'Manual'\n        END                                         AS \"BlockExecutionType\",\n        NULL                                        AS \"BlockOperationType\",\n        '-1'                                        AS \"SystemBlockNumber\",\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"    AS \"CustomerID\"\n    FROM \"KNA1\" AS \"KNA1\"\n        LEFT JOIN \"CTE_BlockFromChangelog\" AS \"Block\"\n                    ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Block\".\"BlockType\" = 'DeliveryBlock'\n        LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n                    ON \"Releases\".\"ReleasesID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Releases\".\"ReleaseType\" = 'DeliveryBlock'\n        LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n                    ON \"Changes\".\"ID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Changes\".\"ChangeType\" = 'DeliveryBlock'\n        LEFT JOIN \"USR02\" AS \"USR02\"\n                    ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                        AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n    WHERE \"Block\".\"BlockID\" IS NULL\n    AND \"Changes\".\"ID\" IS NULL\n    AND \"Releases\".\"ReleasesID\" IS NULL\n    AND \"KNA1\".\"LIFSD\" IS NOT NULL),\n    \"CTE_FirstAction\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"        AS \"BlockID\",\n            MIN(\"JoinTable\".\"JoinTime\") AS \"BlockTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                         AS \"BlockType\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        GROUP BY \"JoinTable\".\"JoinID\", \"JoinTable\".\"FNAME\"\n    ),\n    \"CTE_ImplicitInactiveBlock\" AS (SELECT \"FirstAction\".\"BlockID\"                                 AS \"BlockID\",\n                                           CAST(\"KNA1\".\"ERDAT\" AS DATE)                            AS \"BlockTime\",\n                                           \"FirstAction\".\"BlockType\"                               AS \"BlockType\",\n                                           'Block to '\n                                               ||\n                                           COALESCE(\"Changes\".\"VALUE_OLD\", \"Releases\".\"VALUE_OLD\") AS \"ValueType\",\n                                           COALESCE(\"Changes\".\"VALUE_OLD\", \"Releases\".\"VALUE_OLD\") AS \"VALUE_NEW\",\n                                           NULL                                                    AS \"VALUE_OLD\",\n                                           \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\"                AS \"BlockedBy\",\n                                           CASE\n                                               WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                                                   THEN 'Automatic'\n                                               ELSE 'Manual'\n                                           END                                                     AS \"BlockExecutionType\",\n                                           NULL                                                    AS \"BlockOperationType\",\n                                           '-1'                                                    AS \"SystemBlockNumber\",\n                                           \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"                AS \"CustomerID\"\n                                    FROM \"CTE_FirstAction\" AS \"FirstAction\"\n                                         LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"Changes\".\"ID\"\n                                                       AND \"FirstAction\".\"BlockTime\" = \"Changes\".\"ChangeTime\"\n                                                       AND \"FirstAction\".\"BlockType\" = \"Changes\".\"ChangeType\"\n                                         LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"Releases\".\"ReleasesID\"\n                                                       AND \"FirstAction\".\"BlockTime\" = \"Releases\".\"ReleaseTime\"\n                                                       AND \"FirstAction\".\"BlockType\" = \"Releases\".\"ReleaseType\"\n                                         LEFT JOIN \"KNA1\" AS \"KNA1\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                                                       AND \"FirstAction\".\"BlockType\" IN\n                                                           ('BillingBlock', 'DeliveryBlock')\n                                         LEFT JOIN \"USR02\" AS \"USR02\"\n                                                   ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                                                       AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n                                    WHERE (\"Changes\".\"ID\" IS NOT NULL\n                                        OR \"Releases\".\"ReleasesID\" IS NOT NULL)),\n    \"CTE_ImplicitDuplicates\" AS (\n        SELECT \"Inactive\".\"BlockID\", \"Inactive\".\"BlockTime\", \"Inactive\".\"BlockType\"\n        FROM \"CTE_ImplicitInactiveBlock\" AS \"Inactive\"\n             LEFT JOIN \"CTE_ImplicitActiveBlock\" AS \"Active\"\n                       ON \"Inactive\".\"BlockID\" = \"Active\".\"BlockID\"\n                           AND \"Inactive\".\"BlockTime\" = \"Active\".\"BlockTime\"\n                           AND \"Inactive\".\"BlockType\" = \"Active\".\"BlockType\"\n        WHERE \"Active\".\"BlockID\" IS NOT NULL),\n    \"CTE_ImplicitActiveBlockNoDuplicates\" AS (SELECT \"Active\".*\n                                              FROM \"CTE_ImplicitActiveBlock\" AS \"Active\"\n                                                   LEFT JOIN \"CTE_ImplicitDuplicates\" AS \"Duplicates\"\n                                                             ON \"Active\".\"BlockID\" = \"Duplicates\".\"BlockID\"\n                                                                 AND \"Active\".\"BlockTime\" = \"Duplicates\".\"BlockTime\"\n                                                                 AND \"Active\".\"BlockType\" = \"Duplicates\".\"BlockType\"\n                                              WHERE \"Duplicates\".\"BlockID\" IS NULL),\n    \"CTE_BlockNoRN\"\n        AS (SELECT \"ImplicitActiveBlockNoDuplicates\".\"BlockID\"            AS \"BlockID\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockTime\"          AS \"BlockTime\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockType\"          AS \"BlockType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"ValueType\"          AS \"ValueType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_ImplicitActiveBlockNoDuplicates\" AS \"ImplicitActiveBlockNoDuplicates\"\n            UNION\n            SELECT \"ImplicitInactiveBlock\".\"BlockID\"            AS \"BlockID\",\n                   \"ImplicitInactiveBlock\".\"BlockTime\"          AS \"BlockTime\",\n                   \"ImplicitInactiveBlock\".\"BlockType\"          AS \"BlockType\",\n                   \"ImplicitInactiveBlock\".\"ValueType\"          AS \"ValueType\",\n                   \"ImplicitInactiveBlock\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"ImplicitInactiveBlock\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"ImplicitInactiveBlock\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"ImplicitInactiveBlock\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"ImplicitInactiveBlock\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"ImplicitInactiveBlock\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"ImplicitInactiveBlock\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_ImplicitInactiveBlock\" AS \"ImplicitInactiveBlock\"\n            UNION\n            SELECT \"BlockFromChangelog\".\"BlockID\"            AS \"BlockID\",\n                   \"BlockFromChangelog\".\"BlockTime\"          AS \"BlockTime\",\n                   \"BlockFromChangelog\".\"BlockType\"          AS \"BlockType\",\n                   \"BlockFromChangelog\".\"ValueType\"          AS \"ValueType\",\n                   \"BlockFromChangelog\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"BlockFromChangelog\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"BlockFromChangelog\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"BlockFromChangelog\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"BlockFromChangelog\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"BlockFromChangelog\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"BlockFromChangelog\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_BlockFromChangelog\" AS \"BlockFromChangelog\"),\n    \"CTE_Block\" AS (SELECT *,\n                           ROW_NUMBER()\n                           OVER (PARTITION BY \"BlockNoRN\".\"BlockID\", \"BlockNoRN\".\"BlockType\" ORDER BY \"BlockNoRN\".\"BlockTime\" ASC) AS \"BlockRN\"\n                    FROM \"CTE_BlockNoRN\" AS \"BlockNoRN\")\nSELECT \n    <%=sourceSystem%>  || '::' || \"Block\".\"BlockID\" || '::' || \"Block\".\"SystemBlockNumber\" || '::' ||\n    \"Block\".\"BlockType\"                                    AS \"ID\",\n    \"Block\".\"BlockTime\"                                     AS \"CreationTime\",\n    COALESCE(\"Block\".\"BlockType\", \"Releases\".\"ReleaseType\") AS \"BlockType\",\n    \"Block\".\"VALUE_NEW\"                                     AS \"FirstBlockReason\",\n    CASE\n        WHEN \"Releases\".\"ReleaseType\" IS NOT NULL\n            THEN \"Releases\".\"VALUE_NEW\"\n        WHEN \"Block\".\"BlockType\" = 'BillingBlock'\n            THEN COALESCE(\"KNA1\".\"FAKSD\", 'Data cut - no entry in KNA1')\n        WHEN \"Block\".\"BlockType\" = 'DeliveryBlock'\n            THEN COALESCE(\"KNA1\".\"LIFSD\", 'Data cut - no entry in KNA1')\n    END                                                     AS \"LatestBlockReason\",\n    CASE\n        WHEN \"Releases\".\"ReleaseType\" IS NOT NULL\n            THEN \"Releases\".\"VALUE_NEW\"\n        WHEN \"Block\".\"BlockType\" = 'BillingBlock'\n            THEN \"TVFST\".\"VTEXT\"\n        WHEN \"Block\".\"BlockType\" = 'DeliveryBlock'\n            THEN \"TVLST\".\"VTEXT\"\n    END                                                     AS \"LatestBlockReasonText\",\n\t<%=sourceSystem%> || '::' || \"Block\".\"BlockedBy\"           AS \"BlockedBy\",\n    \"Block\".\"BlockExecutionType\"                               AS \"BlockExecutionType\",\n    \"Releases\".\"ReleaseTime\"                                   AS \"ReleaseTime\",\n    \"Releases\".\"ReleaseType\"                                   AS \"ReleaseType\",\n    \"Releases\".\"VALUE_OLD\"                                     AS \"ReleaseReason\",\n\t<%=sourceSystem%> || '::' || \"Releases\".\"ReleasedBy_ID\"    AS \"ReleasedBy\",\n    \"Releases\".\"ReleaseExecutionType\"                          AS \"ReleaseExecutionType\",\n\t<%=sourceSystem%> || '::' || \"Block\".\"CustomerID\"          AS \"Customer\",\n    <%=sourceSystem%> || '::' || \"KNA1\".\"MANDT\"                AS \"SourceSystemInstance\"\nFROM \"CTE_Block\" AS \"Block\"\n     LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n               ON \"Block\".\"BlockID\" = \"Releases\".\"ReleasesID\"\n                   AND \"Block\".\"BlockRN\" = \"Releases\".\"ReleaseRN\"\n                   AND \"Block\".\"BlockType\" = \"Releases\".\"ReleaseType\"\n     LEFT JOIN \"KNA1\" AS \"KNA1\"\n               ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                   AND (\"KNA1\".\"FAKSD\" IS NOT NULL\n                       OR \"KNA1\".\"LIFSD\" IS NOT NULL)\n     LEFT JOIN \"TVLST\" AS \"TVLST\"\n               ON \"KNA1\".\"MANDT\" = \"TVLST\".\"MANDT\"\n                   AND \"KNA1\".\"LIFSD\" = \"TVLST\".\"LIFSP\"\n                   AND \"TVLST\".\"SPRAS\" = <%=LanguageKey%> \n     LEFT JOIN \"TVFST\" AS \"TVFST\"\n               ON \"KNA1\".\"MANDT\" = \"TVFST\".\"MANDT\"\n                   AND \"KNA1\".\"FAKSD\" = \"TVFST\".\"FAKSP\"\n                   AND \"TVFST\".\"SPRAS\" = <%=LanguageKey%> "
                    }
                ],
                "relationship_transformations": []
            }
        ]
    },
    {
        "change_date": 1764691352320.0,
        "changed_by": {
            "id": "5477e5f1-b56c-404c-b581-116f9517bb0d",
            "name": "Robert Connolly",
            "type_": "USER"
        },
        "created_by": {
            "id": "2202cbc9-7251-4630-bfb2-36812e688613",
            "name": "l.pigozzi",
            "type_": "USER"
        },
        "creation_date": 1749811121015.0,
        "data_connection_id": "b9f449da-3a15-43d8-89e3-0e87e54fb5af",
        "description": null,
        "disabled": null,
        "display_name": "CustomerBlock - 00. Central Extraction Pool_TS1",
        "draft": null,
        "factory_id": "6ae991c5-f710-4ab8-9f86-2b5ded163d58",
        "factory_validation_status": "VALID",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "LanguageKey",
                "value": "'E'"
            },
            {
                "name": "sourceSystem",
                "value": "'SAP_ECC'"
            }
        ],
        "namespace": "custom",
        "target": {
            "entity_ref": {
                "name": "CustomerBlock",
                "namespace": "custom"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [],
                "foreign_key_names": [
                    "BlockedBy",
                    "Customer",
                    "ReleasedBy"
                ],
                "namespace": "custom",
                "property_names": [
                    "BlockExecutionType",
                    "BlockType",
                    "CreationTime",
                    "FirstBlockReason",
                    "ID",
                    "LatestBlockReason",
                    "LatestBlockReasonText",
                    "ReleaseExecutionType",
                    "ReleaseReason",
                    "ReleaseTime",
                    "ReleaseType",
                    "SourceSystemInstance"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "CustomerBlockAttributes",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_JoinTable\" AS (\n    SELECT\n        SUBSTRING(\"CDPOS\".\"TABKEY\", 1, 3)\n            || '::' || SUBSTRING(\"CDPOS\".\"TABKEY\", 4, 10)             AS \"JoinID\",\n        CAST(\"CDHDR\".\"UDATE\" AS DATE)\n            + COALESCE(CAST(TIMESTAMPDIFF(SECOND, CAST(\"CDHDR\".\"UTIME\" AS DATE),\n                    \"CDHDR\".\"UTIME\") AS INTERVAL SECOND), \n                    INTERVAL '86399' SECOND)                           AS \"JoinTime\",\n            \n        \"CDHDR\".\"UDATE\"                                                AS \"UDATE\",\n        \"CDHDR\".\"UTIME\"                                                AS \"UTIME\",\n        \"CDPOS\".\"FNAME\"                                                AS \"FNAME\",\n        \"CDPOS\".\"TABNAME\"                                              AS \"TABNAME\",\n        \"CDPOS\".\"VALUE_NEW\"                                            AS \"VALUE_NEW\",\n        \"CDPOS\".\"VALUE_OLD\"                                            AS \"VALUE_OLD\",\n        \"CDHDR\".\"MANDANT\" || '::' || \"CDHDR\".\"USERNAME\"                AS \"JoinUserID\",\n        CASE\n            WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                THEN 'Automatic'\n            ELSE 'Manual'\n        END                                                            AS \"JoinExecutionType\",\n        \"CDHDR\".\"TCODE\"                                                AS \"JoinOperationType\",\n        \"CDHDR\".\"CHANGENR\"                                             AS \"JoinSystemNumber\",\n        \"CDPOS\".\"OBJECTCLAS\"                                           AS \"OBJECTCLAS\"\n    FROM \"CDPOS\" AS \"CDPOS\"\n    INNER JOIN \"CDHDR\" AS \"CDHDR\"\n        ON \"CDPOS\".\"MANDANT\" = \"CDHDR\".\"MANDANT\"\n            AND \"CDPOS\".\"OBJECTCLAS\" = \"CDHDR\".\"OBJECTCLAS\"\n            AND \"CDPOS\".\"OBJECTID\" = \"CDHDR\".\"OBJECTID\"\n            AND \"CDPOS\".\"CHANGENR\" = \"CDHDR\".\"CHANGENR\"\n            AND \"CDPOS\".\"CHNGIND\" = 'U'\n            AND \"CDPOS\".\"TABNAME\" = 'KNA1'\n            AND \"CDPOS\".\"FNAME\" IN ('FAKSD', 'LIFSD')\n    LEFT JOIN \"USR02\" AS \"USR02\"\n        ON \"CDHDR\".\"MANDANT\" = \"USR02\".\"MANDT\"\n            AND \"CDHDR\".\"USERNAME\" = \"USR02\".\"BNAME\"\n    ),\n    \"CTE_Releases\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                                                                                                    AS \"ReleasesID\",\n            \"JoinTable\".\"JoinTime\"                                                                                                  AS \"ReleaseTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                                                                                                     AS \"ReleaseType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\"                                                                                  AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                                                                                                 AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                                                                                                 AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"                                                                                                AS \"ReleasedBy_ID\",\n            \"JoinTable\".\"JoinExecutionType\"                                                                                         AS \"ReleaseExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"                                                                                         AS \"ReleaseOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"                                                                                          AS \"SystemReleaseNumber\",\n            \"JoinTable\".\"JoinID\"                                                                                                    AS \"CustomerID\",\n            ROW_NUMBER()\n            OVER (PARTITION BY \"JoinTable\".\"JoinID\", \"JoinTable\".\"FNAME\" ORDER BY \"JoinTable\".\"UDATE\" ASC, \"JoinTable\".\"UTIME\" ASC) AS \"ReleaseRN\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NOT NULL\n            AND \"JoinTable\".\"VALUE_NEW\" IS NULL\n    ),\n    \"CTE_Changes\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                       AS \"ID\",\n            \"JoinTable\".\"JoinTime\"                 AS \"ChangeTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                    AS \"ChangeType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\" AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"               AS \"ChangeBy\",\n            \"JoinTable\".\"JoinExecutionType\"        AS \"ChangeExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"        AS \"ChangeOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"         AS \"ChangeID\",\n            \"JoinTable\".\"JoinID\"                   AS \"CustomerID\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NOT NULL\n            AND \"JoinTable\".\"VALUE_NEW\" IS NOT NULL\n    ),\n    \"CTE_BlockFromChangelog\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"                   AS \"BlockID\",\n            \"JoinTable\".\"JoinTime\"                 AS \"BlockTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                                    AS \"BlockType\",\n            'Block to ' || \"JoinTable\".\"VALUE_NEW\" AS \"ValueType\",\n            \"JoinTable\".\"VALUE_NEW\"                AS \"VALUE_NEW\",\n            \"JoinTable\".\"VALUE_OLD\"                AS \"VALUE_OLD\",\n            \"JoinTable\".\"JoinUserID\"               AS \"BlockedBy\",\n            \"JoinTable\".\"JoinExecutionType\"        AS \"BlockExecutionType\",\n            \"JoinTable\".\"JoinOperationType\"        AS \"BlockOperationType\",\n            \"JoinTable\".\"JoinSystemNumber\"         AS \"SystemBlockNumber\",\n            \"JoinTable\".\"JoinID\"                   AS \"CustomerID\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        WHERE \"JoinTable\".\"VALUE_OLD\" IS NULL\n             AND \"JoinTable\".\"VALUE_NEW\" IS NOT NULL\n    ),\n    \"CTE_ImplicitActiveBlock\" AS (\n        SELECT\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\" AS \"BlockID\",\n            CAST(\"KNA1\".\"ERDAT\" AS DATE)             AS \"BlockTime\",\n            'BillingBlock'                           AS \"BlockType\",\n            'Block to ' || \"KNA1\".\"FAKSD\"            AS \"ValueType\",\n            \"KNA1\".\"FAKSD\"                           AS \"VALUE_NEW\",\n            NULL                                     AS \"VALUE_OLD\",\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\" AS \"BlockedBy\",\n            CASE\n                WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                    THEN 'Automatic'\n                ELSE 'Manual'\n            END                                      AS \"BlockExecutionType\",\n            NULL                                     AS \"BlockOperationType\",\n            '-1'                                     AS \"SystemBlockNumber\",\n            \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\" AS \"CustomerID\"\n        FROM \"KNA1\" AS \"KNA1\"\n        LEFT JOIN \"CTE_BlockFromChangelog\" AS \"Block\"\n            ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Block\".\"BlockType\" = 'BillingBlock'\n        LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n            ON \"Releases\".\"ReleasesID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Releases\".\"ReleaseType\" = 'BillingBlock'\n        LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n            ON \"Changes\".\"ID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                AND \"Changes\".\"ChangeType\" = 'BillingBlock'\n        LEFT JOIN \"USR02\" AS \"USR02\"\n            ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n    WHERE \"Block\".\"BlockID\" IS NULL\n        AND \"Changes\".\"ID\" IS NULL\n        AND \"Releases\".\"ReleasesID\" IS NULL\n        AND \"KNA1\".\"FAKSD\" IS NOT NULL\n    UNION\n    SELECT\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"    AS \"BlockID\",\n        CAST(\"KNA1\".\"ERDAT\" AS DATE)                AS \"BlockTime\",\n        'DeliveryBlock'                             AS \"BlockType\",\n        'Block to ' || \"KNA1\".\"LIFSD\"               AS \"ValueType\",\n        \"KNA1\".\"LIFSD\"                              AS \"VALUE_NEW\",\n        NULL                                        AS \"VALUE_OLD\",\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\"    AS \"BlockedBy\",\n        CASE\n            WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                THEN 'Automatic'\n            ELSE 'Manual'\n        END                                         AS \"BlockExecutionType\",\n        NULL                                        AS \"BlockOperationType\",\n        '-1'                                        AS \"SystemBlockNumber\",\n        \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"    AS \"CustomerID\"\n    FROM \"KNA1\" AS \"KNA1\"\n        LEFT JOIN \"CTE_BlockFromChangelog\" AS \"Block\"\n                    ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Block\".\"BlockType\" = 'DeliveryBlock'\n        LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n                    ON \"Releases\".\"ReleasesID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Releases\".\"ReleaseType\" = 'DeliveryBlock'\n        LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n                    ON \"Changes\".\"ID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                        AND \"Changes\".\"ChangeType\" = 'DeliveryBlock'\n        LEFT JOIN \"USR02\" AS \"USR02\"\n                    ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                        AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n    WHERE \"Block\".\"BlockID\" IS NULL\n    AND \"Changes\".\"ID\" IS NULL\n    AND \"Releases\".\"ReleasesID\" IS NULL\n    AND \"KNA1\".\"LIFSD\" IS NOT NULL),\n    \"CTE_FirstAction\" AS (\n        SELECT\n            \"JoinTable\".\"JoinID\"        AS \"BlockID\",\n            MIN(\"JoinTable\".\"JoinTime\") AS \"BlockTime\",\n            CASE\n                WHEN \"JoinTable\".\"FNAME\" = 'FAKSD'\n                    THEN 'BillingBlock'\n                WHEN \"JoinTable\".\"FNAME\" = 'LIFSD'\n                    THEN 'DeliveryBlock'\n            END                         AS \"BlockType\"\n        FROM \"CTE_JoinTable\" AS \"JoinTable\"\n        GROUP BY \"JoinTable\".\"JoinID\", \"JoinTable\".\"FNAME\"\n    ),\n    \"CTE_ImplicitInactiveBlock\" AS (SELECT \"FirstAction\".\"BlockID\"                                 AS \"BlockID\",\n                                           CAST(\"KNA1\".\"ERDAT\" AS DATE)                            AS \"BlockTime\",\n                                           \"FirstAction\".\"BlockType\"                               AS \"BlockType\",\n                                           'Block to '\n                                               ||\n                                           COALESCE(\"Changes\".\"VALUE_OLD\", \"Releases\".\"VALUE_OLD\") AS \"ValueType\",\n                                           COALESCE(\"Changes\".\"VALUE_OLD\", \"Releases\".\"VALUE_OLD\") AS \"VALUE_NEW\",\n                                           NULL                                                    AS \"VALUE_OLD\",\n                                           \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"ERNAM\"                AS \"BlockedBy\",\n                                           CASE\n                                               WHEN \"USR02\".\"USTYP\" IN ('B', 'C')\n                                                   THEN 'Automatic'\n                                               ELSE 'Manual'\n                                           END                                                     AS \"BlockExecutionType\",\n                                           NULL                                                    AS \"BlockOperationType\",\n                                           '-1'                                                    AS \"SystemBlockNumber\",\n                                           \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"                AS \"CustomerID\"\n                                    FROM \"CTE_FirstAction\" AS \"FirstAction\"\n                                         LEFT JOIN \"CTE_Changes\" AS \"Changes\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"Changes\".\"ID\"\n                                                       AND \"FirstAction\".\"BlockTime\" = \"Changes\".\"ChangeTime\"\n                                                       AND \"FirstAction\".\"BlockType\" = \"Changes\".\"ChangeType\"\n                                         LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"Releases\".\"ReleasesID\"\n                                                       AND \"FirstAction\".\"BlockTime\" = \"Releases\".\"ReleaseTime\"\n                                                       AND \"FirstAction\".\"BlockType\" = \"Releases\".\"ReleaseType\"\n                                         LEFT JOIN \"KNA1\" AS \"KNA1\"\n                                                   ON \"FirstAction\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                                                       AND \"FirstAction\".\"BlockType\" IN\n                                                           ('BillingBlock', 'DeliveryBlock')\n                                         LEFT JOIN \"USR02\" AS \"USR02\"\n                                                   ON \"KNA1\".\"MANDT\" = \"USR02\".\"MANDT\"\n                                                       AND \"KNA1\".\"ERNAM\" = \"USR02\".\"BNAME\"\n                                    WHERE (\"Changes\".\"ID\" IS NOT NULL\n                                        OR \"Releases\".\"ReleasesID\" IS NOT NULL)),\n    \"CTE_ImplicitDuplicates\" AS (\n        SELECT \"Inactive\".\"BlockID\", \"Inactive\".\"BlockTime\", \"Inactive\".\"BlockType\"\n        FROM \"CTE_ImplicitInactiveBlock\" AS \"Inactive\"\n             LEFT JOIN \"CTE_ImplicitActiveBlock\" AS \"Active\"\n                       ON \"Inactive\".\"BlockID\" = \"Active\".\"BlockID\"\n                           AND \"Inactive\".\"BlockTime\" = \"Active\".\"BlockTime\"\n                           AND \"Inactive\".\"BlockType\" = \"Active\".\"BlockType\"\n        WHERE \"Active\".\"BlockID\" IS NOT NULL),\n    \"CTE_ImplicitActiveBlockNoDuplicates\" AS (SELECT \"Active\".*\n                                              FROM \"CTE_ImplicitActiveBlock\" AS \"Active\"\n                                                   LEFT JOIN \"CTE_ImplicitDuplicates\" AS \"Duplicates\"\n                                                             ON \"Active\".\"BlockID\" = \"Duplicates\".\"BlockID\"\n                                                                 AND \"Active\".\"BlockTime\" = \"Duplicates\".\"BlockTime\"\n                                                                 AND \"Active\".\"BlockType\" = \"Duplicates\".\"BlockType\"\n                                              WHERE \"Duplicates\".\"BlockID\" IS NULL),\n    \"CTE_BlockNoRN\"\n        AS (SELECT \"ImplicitActiveBlockNoDuplicates\".\"BlockID\"            AS \"BlockID\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockTime\"          AS \"BlockTime\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockType\"          AS \"BlockType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"ValueType\"          AS \"ValueType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"ImplicitActiveBlockNoDuplicates\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_ImplicitActiveBlockNoDuplicates\" AS \"ImplicitActiveBlockNoDuplicates\"\n            UNION\n            SELECT \"ImplicitInactiveBlock\".\"BlockID\"            AS \"BlockID\",\n                   \"ImplicitInactiveBlock\".\"BlockTime\"          AS \"BlockTime\",\n                   \"ImplicitInactiveBlock\".\"BlockType\"          AS \"BlockType\",\n                   \"ImplicitInactiveBlock\".\"ValueType\"          AS \"ValueType\",\n                   \"ImplicitInactiveBlock\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"ImplicitInactiveBlock\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"ImplicitInactiveBlock\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"ImplicitInactiveBlock\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"ImplicitInactiveBlock\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"ImplicitInactiveBlock\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"ImplicitInactiveBlock\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_ImplicitInactiveBlock\" AS \"ImplicitInactiveBlock\"\n            UNION\n            SELECT \"BlockFromChangelog\".\"BlockID\"            AS \"BlockID\",\n                   \"BlockFromChangelog\".\"BlockTime\"          AS \"BlockTime\",\n                   \"BlockFromChangelog\".\"BlockType\"          AS \"BlockType\",\n                   \"BlockFromChangelog\".\"ValueType\"          AS \"ValueType\",\n                   \"BlockFromChangelog\".\"VALUE_NEW\"          AS \"VALUE_NEW\",\n                   \"BlockFromChangelog\".\"VALUE_OLD\"          AS \"VALUE_OLD\",\n                   \"BlockFromChangelog\".\"BlockedBy\"          AS \"BlockedBy\",\n                   \"BlockFromChangelog\".\"BlockExecutionType\" AS \"BlockExecutionType\",\n                   \"BlockFromChangelog\".\"BlockOperationType\" AS \"BlockOperationType\",\n                   \"BlockFromChangelog\".\"SystemBlockNumber\"  AS \"SystemBlockNumber\",\n                   \"BlockFromChangelog\".\"CustomerID\"         AS \"CustomerID\"\n            FROM \"CTE_BlockFromChangelog\" AS \"BlockFromChangelog\"),\n    \"CTE_Block\" AS (SELECT *,\n                           ROW_NUMBER()\n                           OVER (PARTITION BY \"BlockNoRN\".\"BlockID\", \"BlockNoRN\".\"BlockType\" ORDER BY \"BlockNoRN\".\"BlockTime\" ASC) AS \"BlockRN\"\n                    FROM \"CTE_BlockNoRN\" AS \"BlockNoRN\")\nSELECT \n    <%=sourceSystem%>  || '::' || \"Block\".\"BlockID\" || '::' || \"Block\".\"SystemBlockNumber\" || '::' ||\n    \"Block\".\"BlockType\"                                    AS \"ID\",\n    \"Block\".\"BlockTime\"                                     AS \"CreationTime\",\n    COALESCE(\"Block\".\"BlockType\", \"Releases\".\"ReleaseType\") AS \"BlockType\",\n    \"Block\".\"VALUE_NEW\"                                     AS \"FirstBlockReason\",\n    CASE\n        WHEN \"Releases\".\"ReleaseType\" IS NOT NULL\n            THEN \"Releases\".\"VALUE_NEW\"\n        WHEN \"Block\".\"BlockType\" = 'BillingBlock'\n            THEN COALESCE(\"KNA1\".\"FAKSD\", 'Data cut - no entry in KNA1')\n        WHEN \"Block\".\"BlockType\" = 'DeliveryBlock'\n            THEN COALESCE(\"KNA1\".\"LIFSD\", 'Data cut - no entry in KNA1')\n    END                                                     AS \"LatestBlockReason\",\n    CASE\n        WHEN \"Releases\".\"ReleaseType\" IS NOT NULL\n            THEN \"Releases\".\"VALUE_NEW\"\n        WHEN \"Block\".\"BlockType\" = 'BillingBlock'\n            THEN \"TVFST\".\"VTEXT\"\n        WHEN \"Block\".\"BlockType\" = 'DeliveryBlock'\n            THEN \"TVLST\".\"VTEXT\"\n    END                                                     AS \"LatestBlockReasonText\",\n\t<%=sourceSystem%> || '::' || \"Block\".\"BlockedBy\"           AS \"BlockedBy\",\n    \"Block\".\"BlockExecutionType\"                               AS \"BlockExecutionType\",\n    \"Releases\".\"ReleaseTime\"                                   AS \"ReleaseTime\",\n    \"Releases\".\"ReleaseType\"                                   AS \"ReleaseType\",\n    \"Releases\".\"VALUE_OLD\"                                     AS \"ReleaseReason\",\n\t<%=sourceSystem%> || '::' || \"Releases\".\"ReleasedBy_ID\"    AS \"ReleasedBy\",\n    \"Releases\".\"ReleaseExecutionType\"                          AS \"ReleaseExecutionType\",\n\t<%=sourceSystem%> || '::' || \"Block\".\"CustomerID\"          AS \"Customer\",\n    <%=sourceSystem%> || '::' || \"KNA1\".\"MANDT\"                AS \"SourceSystemInstance\"\nFROM \"CTE_Block\" AS \"Block\"\n     LEFT JOIN \"CTE_Releases\" AS \"Releases\"\n               ON \"Block\".\"BlockID\" = \"Releases\".\"ReleasesID\"\n                   AND \"Block\".\"BlockRN\" = \"Releases\".\"ReleaseRN\"\n                   AND \"Block\".\"BlockType\" = \"Releases\".\"ReleaseType\"\n     LEFT JOIN \"KNA1\" AS \"KNA1\"\n               ON \"Block\".\"BlockID\" = \"KNA1\".\"MANDT\" || '::' || \"KNA1\".\"KUNNR\"\n                   AND (\"KNA1\".\"FAKSD\" IS NOT NULL\n                       OR \"KNA1\".\"LIFSD\" IS NOT NULL)\n     LEFT JOIN \"TVLST\" AS \"TVLST\"\n               ON \"KNA1\".\"MANDT\" = \"TVLST\".\"MANDT\"\n                   AND \"KNA1\".\"LIFSD\" = \"TVLST\".\"LIFSP\"\n                   AND \"TVLST\".\"SPRAS\" = <%=LanguageKey%> \n     LEFT JOIN \"TVFST\" AS \"TVFST\"\n               ON \"KNA1\".\"MANDT\" = \"TVFST\".\"MANDT\"\n                   AND \"KNA1\".\"FAKSD\" = \"TVFST\".\"FAKSP\"\n                   AND \"TVFST\".\"SPRAS\" = <%=LanguageKey%> "
                    }
                ],
                "relationship_transformations": []
            }
        ]
    }
]