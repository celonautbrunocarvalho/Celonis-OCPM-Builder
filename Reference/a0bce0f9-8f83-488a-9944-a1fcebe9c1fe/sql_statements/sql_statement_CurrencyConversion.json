[
    {
        "change_date": 1770400798664.0,
        "changed_by": {
            "id": "cccccccc-cccc-cccc-cccc-cccccccccccc",
            "name": "Celonis",
            "type_": "APPLICATION"
        },
        "created_by": {
            "id": "cccccccc-cccc-cccc-cccc-cccccccccccc",
            "name": "Celonis",
            "type_": "APPLICATION"
        },
        "creation_date": 1770400798664.0,
        "data_connection_id": "b3c59e17-798d-49ea-b0b3-99d0bae2e011",
        "description": null,
        "disabled": null,
        "display_name": "CurrencyConversion",
        "draft": null,
        "factory_id": "95a6f901-b611-4f5f-82b6-370328fd5e20_b3c59e17-798d-49ea-b0b3-99d0bae2e011",
        "factory_validation_status": "NOT_VALIDATED",
        "has_user_template": null,
        "local_parameters": [
            {
                "name": "CurrencyKey",
                "value": "'EUR'"
            },
            {
                "name": "ExchangeRateType",
                "value": "'EURX'"
            },
            {
                "name": "sourceSystem",
                "value": "''"
            }
        ],
        "namespace": "celonis",
        "target": {
            "entity_ref": {
                "name": "CurrencyConversion",
                "namespace": "celonis"
            },
            "kind": "OBJECT"
        },
        "transformations": [
            {
                "change_sql_factory_datasets": [],
                "foreign_key_names": [],
                "namespace": "celonis",
                "property_names": [
                    "ExchangeRateType",
                    "FromCurrency",
                    "FromDate",
                    "ID",
                    "Rate",
                    "SourceSystemInstance",
                    "SourceSystemType",
                    "ToCurrency",
                    "ToDate"
                ],
                "property_sql_factory_datasets": [
                    {
                        "id": "CTE_DATE_RANGE",
                        "type_": "SQL_FACTORY_DATA_SET",
                        "complete_overwrite": false,
                        "disabled": false,
                        "materialise_cte": false,
                        "overwrite": null,
                        "sql": "WITH \"CTE_TCURF_TMP\" AS (SELECT \"TCURF\".\"MANDT\",\n                               \"TCURF\".\"KURST\",\n                               \"TCURF\".\"FCURR\",\n                               \"TCURF\".\"TCURR\",\n                               \"TCURF\".\"GDATU\",\n                               \"TCURF\".\"FFACT\",\n                               \"TCURF\".\"TFACT\",\n                               DENSE_RANK()\n                               OVER (ORDER BY \"TCURF\".\"MANDT\", \"TCURF\".\"KURST\", \"TCURF\".\"FCURR\", \"TCURF\".\"TCURR\") AS \"TCURF_KEY\",\n                               ROW_NUMBER()\n                               OVER (PARTITION BY \"TCURF\".\"MANDT\", \"TCURF\".\"KURST\", \"TCURF\".\"FCURR\", \"TCURF\".\"TCURR\"\n                                   ORDER BY CAST(\"TCURF\".\"GDATU\" AS INT) DESC)                                    AS \"TCURF_ROWNR\"\n                        FROM \"TCURF\" AS \"TCURF\"\n                        WHERE (99999999 - CAST(\"TCURF\".\"GDATU\" AS INT)) >= 18000000\n                          AND (99999999 - CAST(\"TCURF\".\"GDATU\" AS INT)) <= 20990000),\n    \"CTE_TCURF_CC\" AS (SELECT *,\n                              CAST(LPAD(CAST((99999999 - CAST(\"TCURF_TMP\".\"GDATU\" AS INT)) AS VARCHAR(10)), 8, '0')\n                                   || ' '\n                                   || '00:00:00' AS TIMESTAMP) AS \"VALID_START\"\n                       FROM \"CTE_TCURF_TMP\" AS \"TCURF_TMP\"),\n    \"CTE_TCURF_CC_2\" AS (SELECT \"TCURF_CC\".*,\n                                CASE\n                                    WHEN \"TCURF_CC_Offset\".\"TCURF_ROWNR\" IS NOT NULL\n                                        THEN \"TCURF_CC_Offset\".\"VALID_START\"\n                                    ELSE CAST('2099-01-01' AS TIMESTAMP) END AS \"VALID_END\"\n                         FROM \"CTE_TCURF_CC\" AS \"TCURF_CC\"\n                                  LEFT JOIN \"CTE_TCURF_CC\" AS \"TCURF_CC_Offset\"\n                                            ON \"TCURF_CC\".\"TCURF_KEY\" = \"TCURF_CC_Offset\".\"TCURF_KEY\"\n                                                AND \"TCURF_CC\".\"TCURF_ROWNR\" + 1 = \"TCURF_CC_Offset\".\"TCURF_ROWNR\"),\n    \"CTE_TCURR_TMP\" AS (SELECT \"TCURR\".\"MANDT\",\n                               \"TCURR\".\"KURST\",\n                               \"TCURR\".\"FCURR\",\n                               \"TCURR\".\"TCURR\",\n                               \"TCURR\".\"GDATU\",\n                               \"TCURR\".\"UKURS\",\n                               \"TCURR\".\"FFACT\",\n                               \"TCURR\".\"TFACT\",\n                               DENSE_RANK()\n                               OVER (ORDER BY \"TCURR\".\"MANDT\", \"TCURR\".\"KURST\", \"TCURR\".\"FCURR\", \"TCURR\".\"TCURR\") AS \"TCURR_KEY\",\n                               ROW_NUMBER()\n                               OVER (PARTITION BY \"TCURR\".\"MANDT\", \"TCURR\".\"KURST\", \"TCURR\".\"FCURR\", \"TCURR\".\"TCURR\"\n                                   ORDER BY CAST(\"TCURR\".\"GDATU\" AS INT) DESC)                                    AS \"TCURR_ROWNR\"\n                        FROM \"TCURR\" AS \"TCURR\"\n                        WHERE (99999999 - CAST(\"TCURR\".\"GDATU\" AS INT)) >= 18000000\n                          AND (99999999 - CAST(\"TCURR\".\"GDATU\" AS INT)) <= 20990000),\n    \"CTE_TCURR_CC\" AS (SELECT *,\n                            CAST(LPAD(CAST((99999999 - CAST(\"TCURR_TMP\".\"GDATU\" AS INT)) AS VARCHAR(10)), 8, '0') || ' '\n                                   || '00:00:00' AS TIMESTAMP) AS \"VALID_START\"\n                       FROM \"CTE_TCURR_TMP\" AS \"TCURR_TMP\"),\n    \"CTE_TCURR_CC_2\" AS (SELECT \"TCURR_CC\".*,\n                                CASE\n                                    WHEN \"TCURR_CC_Offset\".\"TCURR_ROWNR\" IS NOT NULL\n                                        THEN \"TCURR_CC_Offset\".\"VALID_START\"\n                                    ELSE CAST('2099-01-01' AS TIMESTAMP) END AS \"VALID_END\"\n                         FROM \"CTE_TCURR_CC\" AS \"TCURR_CC\"\n                                  LEFT JOIN \"CTE_TCURR_CC\" AS \"TCURR_CC_Offset\"\n                                            ON \"TCURR_CC\".\"TCURR_KEY\" = \"TCURR_CC_Offset\".\"TCURR_KEY\"\n                                                AND \"TCURR_CC\".\"TCURR_ROWNR\" + 1 = \"TCURR_CC_Offset\".\"TCURR_ROWNR\"),\n    \"CTE_DATE_RANGE\" AS (SELECT CAST(\"CELONIS_CALENDAR\".\"Date\" AS TIMESTAMP) AS \"_DATE\"\n                         FROM \"CELONIS_CALENDAR\"\n                         WHERE \"CELONIS_CALENDAR\".\"Date\" >= '2017-01-01'\n                           AND \"CELONIS_CALENDAR\".\"Date\" <= NOW()\n                         ORDER BY \"CELONIS_CALENDAR\".\"Date\"),\n    \"CTE_TCURX\" AS (SELECT \"TCURX\".\"CURRKEY\",\n                           CAST(\"TCURX\".\"CURRDEC\" AS INT)            AS \"CURRDEC\",\n                           POWER(CAST(10 AS FLOAT), (2 - \"CURRDEC\")) AS \"TDEC\"\n                    FROM \"TCURX\" AS \"TCURX\")\nSELECT <%=sourceSystem%>  || 'CurrencyConversion_' || \"TCURR_CC_2\".\"FCURR\" || '_' || \"TCURR_CC_2\".\"TCURR\"\n           || '_' || \"_DATE\" || '_' || 'SAP' || '_' || \"TCURR_CC_2\".\"MANDT\" AS \"ID\",\n       \"TCURR_CC_2\".\"FCURR\"                                                 AS \"FromCurrency\",\n       \"TCURR_CC_2\".\"TCURR\"                                                 AS \"ToCurrency\",\n       \"DATE_RANGE\".\"_DATE\"                                                 AS \"FromDate\",\n       \"DATE_RANGE\".\"_DATE\"                                                 AS \"ToDate\",\n       CASE\n           WHEN \"TCURR_CC_2\".\"UKURS\" < 0 THEN (1 / ABS(\"TCURR_CC_2\".\"UKURS\"))\n           ELSE \"TCURR_CC_2\".\"UKURS\" END\n           *\n       COALESCE(\"TCURX\".\"TDEC\", 1)\n           /\n       COALESCE(\"TCURF_CC_2\".\"FFACT\", \"TCURR_CC_2\".\"FFACT\", 1)\n           *\n       COALESCE(\"TCURF_CC_2\".\"TFACT\", \"TCURR_CC_2\".\"TFACT\", 1)\n                                                                            AS \"Rate\",\n       'SAP'                                                                AS \"SourceSystemType\",\n       \"TCURR_CC_2\".\"MANDT\"                                                 AS \"SourceSystemInstance\",\n       \"TCURR_CC_2\".\"KURST\"                                                 AS \"ExchangeRateType\"\nFROM \"CTE_DATE_RANGE\" AS \"DATE_RANGE\"\n         LEFT JOIN \"CTE_TCURR_CC_2\" AS \"TCURR_CC_2\"\n                   ON \"TCURR_CC_2\".\"TCURR\" = <%=CurrencyKey%> \n                       AND \"TCURR_CC_2\".\"KURST\" = <%=ExchangeRateType%> \n                       AND \"DATE_RANGE\".\"_DATE\" >= \"TCURR_CC_2\".\"VALID_START\"\n                       AND \"DATE_RANGE\".\"_DATE\" < \"TCURR_CC_2\".\"VALID_END\"\n         LEFT JOIN \"CTE_TCURF_CC_2\" AS \"TCURF_CC_2\"\n                   ON \"TCURR_CC_2\".\"MANDT\" = \"TCURF_CC_2\".\"MANDT\"\n                       AND \"TCURR_CC_2\".\"TCURR\" = \"TCURF_CC_2\".\"TCURR\"\n                       AND \"TCURR_CC_2\".\"FCURR\" = \"TCURF_CC_2\".\"FCURR\"\n                       AND \"TCURR_CC_2\".\"KURST\" = \"TCURF_CC_2\".\"KURST\"\n                       AND \"DATE_RANGE\".\"_DATE\" >= \"TCURF_CC_2\".\"VALID_START\"\n                       AND \"DATE_RANGE\".\"_DATE\" < \"TCURF_CC_2\".\"VALID_END\"\n         LEFT JOIN \"CTE_TCURX\" AS \"TCURX\"\n                   ON \"TCURR_CC_2\".\"FCURR\" = \"TCURX\".\"CURRKEY\"\nWHERE \"TCURR_CC_2\".\"MANDT\" IS NOT NULL\n"
                    }
                ],
                "relationship_transformations": []
            }
        ]
    }
]